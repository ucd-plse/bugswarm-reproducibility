travis_fold:start:system_info[0K[33;1mBuild system information[0m
Build language: python
Build group: stable
Build dist: precise
Build id: ''
Job id: ''
[34m[1mBuild image provisioning date and time[0m
Thu Feb  5 15:09:33 UTC 2015
[34m[1mOperating System Details[0m
Distributor ID:	Ubuntu
Description:	Ubuntu 12.04.5 LTS
Release:	12.04
Codename:	precise
[34m[1mLinux Version[0m
3.13.0-29-generic
[34m[1mCookbooks Version[0m
a68419e https://github.com/travis-ci/travis-cookbooks/tree/a68419e
[34m[1mGCC version[0m
gcc (Ubuntu/Linaro 4.6.3-1ubuntu5) 4.6.3
Copyright (C) 2011 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

[34m[1mLLVM version[0m
clang version 3.4 (tags/RELEASE_34/final)
Target: x86_64-unknown-linux-gnu
Thread model: posix
[34m[1mPre-installed Ruby versions[0m
ruby-1.9.3-p551
[34m[1mPre-installed Node.js versions[0m
v0.10.36
[34m[1mPre-installed Go versions[0m
1.4.1
[34m[1mRedis version[0m
redis-server 2.8.19
[34m[1mriak version[0m
2.0.2
[34m[1mMongoDB version[0m
MongoDB 2.4.12
[34m[1mCouchDB version[0m
couchdb 1.6.1
[34m[1mNeo4j version[0m
1.9.4
[34m[1mRabbitMQ Version[0m
3.4.3
[34m[1mElasticSearch version[0m
1.4.0
[34m[1mInstalled Sphinx versions[0m
2.0.10
2.1.9
2.2.6
[34m[1mDefault Sphinx version[0m
2.2.6
[34m[1mInstalled Firefox version[0m
firefox 31.0esr
[34m[1mPhantomJS version[0m
1.9.8
[34m[1mant -version[0m
Apache Ant(TM) version 1.8.2 compiled on December 3 2011
[34m[1mmvn -version[0m
Apache Maven 3.2.5 (12a6b3acb947671f09b81f49094c53f426d8cea1; 2014-12-14T17:29:23+00:00)
Maven home: /usr/local/maven
Java version: 1.7.0_76, vendor: Oracle Corporation
Java home: /usr/lib/jvm/java-7-oracle/jre
Default locale: en_US, platform encoding: ANSI_X3.4-1968
OS name: "linux", version: "3.13.0-29-generic", arch: "amd64", family: "unix"
travis_fold:end:system_info[0K
[33;1m3.5 is not installed; attempting download[0m
[33;1mDownloading archive: https://s3.amazonaws.com/travis-python-archives/binaries/ubuntu/12.04/x86_64/python-3.5.tar.bz2[0m
$ sudo tar xjf python-3.5.tar.bz2 --directory /
$ cd failed/zopefoundation/ZODB
travis_time:start:3091f0f5[0K$ source ~/virtualenv/python3.5/bin/activate

travis_time:end:3091f0f5:start=1591601560494852407,finish=1591601560505330177,duration=10477770[0Ktravis_fold:start:cache.1[0KSetting up build cache
$ export CASHER_DIR=$HOME/.casher
travis_time:start:030c91d4[0K$ Installing caching utilities

travis_time:end:030c91d4:start=1591601560885405786,finish=1591601560953282727,duration=67876941[0Ktravis_time:start:04c69a73[0K
travis_time:end:04c69a73:start=1591601560968149159,finish=1591601560977188317,duration=9039158[0Ktravis_time:start:0504f960[0K[32;1mattempting to download cache archive[0m

travis_time:end:0504f960:start=1591601560988057882,finish=1591601561771921940,duration=783864058[0Ktravis_time:start:0071ebe0[0K
travis_time:end:0071ebe0:start=1591601561783920797,finish=1591601561792688135,duration=8767338[0Ktravis_time:start:05ad646d[0K[32;1madding /home/travis/.cache/pip to cache[0m

travis_time:end:05ad646d:start=1591601561802288905,finish=1591601562596412667,duration=794123762[0Ktravis_fold:end:cache.1[0K$ python --version
Python 3.5.6
$ pip --version
pip 18.0 from /home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/pip (python 3.5)
travis_fold:start:install.1[0Ktravis_time:start:2c8d7840[0K$ travis_retry pip install -U pip==8.1.2
Collecting pip==8.1.2
  Downloading https://files.pythonhosted.org/packages/9c/32/004ce0852e0a127f07f358b715015763273799bd798956fa930814b60f39/pip-8.1.2-py2.py3-none-any.whl (1.2MB)
Installing collected packages: pip
  Found existing installation: pip 18.0
    Uninstalling pip-18.0:
      Successfully uninstalled pip-18.0
Successfully installed pip-8.1.2

travis_time:end:2c8d7840:start=1591601563077702009,finish=1591601567286740308,duration=4209038299[0Ktravis_fold:end:install.1[0Ktravis_fold:start:install.2[0Ktravis_time:start:0706e1e8[0K$ travis_retry pip install -U wheel==0.29.0
Collecting wheel==0.29.0
  Downloading https://files.pythonhosted.org/packages/8a/e9/8468cd68b582b06ef554be0b96b59f59779627131aad48f8a5bce4b13450/wheel-0.29.0-py2.py3-none-any.whl (66kB)
Installing collected packages: wheel
  Found existing installation: wheel 0.31.1
    Uninstalling wheel-0.31.1:
      Successfully uninstalled wheel-0.31.1
Successfully installed wheel-0.29.0

travis_time:end:0706e1e8:start=1591601567299154365,finish=1591601568251000861,duration=951846496[0Ktravis_fold:end:install.2[0Ktravis_fold:start:install.3[0Ktravis_time:start:1c701a0b[0K$ travis_retry pip install -U manuel==1.8.0 zope.testing==4.5.0 zope.testrunner==4.5.1
Collecting manuel==1.8.0
  Downloading https://files.pythonhosted.org/packages/61/f1/010200691df26b5eb55180c75ef904b6ea19f66057b81838b02f8400fe33/manuel-1.8.0.tar.gz (207kB)
Collecting zope.testing==4.5.0
  Downloading https://files.pythonhosted.org/packages/a3/07/164a6bf2b6979e136986548e70807fbe15d6eaf13a6ea455c357dd8f616d/zope.testing-4.5.0.tar.gz (72kB)
Collecting zope.testrunner==4.5.1
  Downloading https://files.pythonhosted.org/packages/46/8d/40b0b3b81088f731943b5b2fdf72ab17d533f56b5727db18b2ec424b5b7d/zope.testrunner-4.5.1.zip (268kB)
Collecting setuptools (from manuel==1.8.0)
  Downloading https://files.pythonhosted.org/packages/95/95/f657b6e17f00c3f35b5f68b10e46c3a43af353d8856bd57bfcfb1dbb3e92/setuptools-47.1.1-py3-none-any.whl (583kB)
Collecting six (from manuel==1.8.0)
  Downloading https://files.pythonhosted.org/packages/ee/ff/48bde5c0f013094d729fe4b0316ba2a24774b3ff1c52d924a8a4cb04078a/six-1.15.0-py2.py3-none-any.whl
Collecting zope.exceptions (from zope.testing==4.5.0)
  Downloading https://files.pythonhosted.org/packages/fa/d8/c186f22885ef4e3c0f6ea22f27a8d99cdd59b87b64498854a35d5b1608f2/zope.exceptions-4.3-py2.py3-none-any.whl
Collecting zope.interface (from zope.testing==4.5.0)
  Downloading https://files.pythonhosted.org/packages/dd/04/ebebe4868f5166ca461ceba7145b5f9e3426c3361e8b51cef6ecc0d2af95/zope.interface-5.1.0-cp35-cp35m-manylinux1_x86_64.whl (234kB)
Building wheels for collected packages: manuel, zope.testing, zope.testrunner
  Running setup.py bdist_wheel for manuel: started
  Running setup.py bdist_wheel for manuel: finished with status 'done'
  Stored in directory: /home/travis/.cache/pip/wheels/a3/a8/d4/51c8b4c7114c76c9c9a6e5fc62e17f2d12074e76cf0069c0bf
  Running setup.py bdist_wheel for zope.testing: started
  Running setup.py bdist_wheel for zope.testing: finished with status 'done'
  Stored in directory: /home/travis/.cache/pip/wheels/54/ce/d6/8432b01da3ecfeec1fafe89137c61a4203d4ea27804e43d31c
  Running setup.py bdist_wheel for zope.testrunner: started
  Running setup.py bdist_wheel for zope.testrunner: finished with status 'done'
  Stored in directory: /home/travis/.cache/pip/wheels/90/87/70/06b905b10a44d4e10d50fd8a0b1801e2b6fb0d8a9ea9aa8b4c
Successfully built manuel zope.testing zope.testrunner
Installing collected packages: setuptools, six, manuel, zope.interface, zope.exceptions, zope.testing, zope.testrunner
  Found existing installation: setuptools 40.0.0
    Uninstalling setuptools-40.0.0:
      Successfully uninstalled setuptools-40.0.0
  Found existing installation: six 1.11.0
    Uninstalling six-1.11.0:
      Successfully uninstalled six-1.11.0
Successfully installed manuel-1.8.0 setuptools-47.1.1 six-1.15.0 zope.exceptions-4.3 zope.interface-5.1.0 zope.testing-4.5.0 zope.testrunner-4.5.1

travis_time:end:1c701a0b:start=1591601568263886919,finish=1591601585182446972,duration=16918560053[0Ktravis_fold:end:install.3[0Ktravis_fold:start:install.4[0Ktravis_time:start:215a5f7e[0K$ travis_retry pip install -U -e .
Obtaining file:///home/travis/build/failed/zopefoundation/ZODB
Collecting persistent>=4.2.0 (from ZODB==5.0.0a6)
  Using cached https://files.pythonhosted.org/packages/1e/64/8a40c95d19f603c8b9f100f846747ef2c359778b2d586b184042062f9112/persistent-4.6.4-cp35-cp35m-manylinux1_x86_64.whl
Collecting BTrees>=4.2.0 (from ZODB==5.0.0a6)
  Downloading https://files.pythonhosted.org/packages/95/1f/21c3d8bdc94ec06ebba21d6bfd6f6453c111df451d14d998b24c6d9e59e8/BTrees-4.7.2-cp35-cp35m-manylinux1_x86_64.whl (3.0MB)
Collecting ZConfig (from ZODB==5.0.0a6)
  Downloading https://files.pythonhosted.org/packages/d2/33/533ba4b7e39e8fc16dbdf796a84c57b27956a72103ce4bfe2dd354f9fd2a/ZConfig-3.5.0-py2.py3-none-any.whl (134kB)
Collecting transaction>=1.6.1 (from ZODB==5.0.0a6)
  Downloading https://files.pythonhosted.org/packages/e8/06/17b311f04ee623bea66f2f2a93a1b5691e383278d7d30980bba3f1c03ce9/transaction-3.0.0-py2.py3-none-any.whl (47kB)
Requirement already up-to-date: six in /home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages (from ZODB==5.0.0a6)
Collecting zc.lockfile (from ZODB==5.0.0a6)
  Downloading https://files.pythonhosted.org/packages/6c/2a/268389776288f0f26c7272c70c36c96dcc0bdb88ab6216ea18e19df1fadd/zc.lockfile-2.0-py2.py3-none-any.whl
Requirement already up-to-date: zope.interface in /home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages (from ZODB==5.0.0a6)
Collecting zodbpickle>=0.6.0 (from ZODB==5.0.0a6)
  Downloading https://files.pythonhosted.org/packages/a9/33/83de27f2f7df240a0e5b949e8201e83f0acb9dd5d47f5cab73e908bf49d8/zodbpickle-2.0.0-cp35-cp35m-manylinux1_x86_64.whl (331kB)
Collecting cffi; platform_python_implementation == "CPython" (from persistent>=4.2.0->ZODB==5.0.0a6)
  Using cached https://files.pythonhosted.org/packages/d6/7f/7acc85c478f5056b98c9961a31697b1e53fbec158ee5f723097e1c355660/cffi-1.14.0-cp35-cp35m-manylinux1_x86_64.whl
Requirement already up-to-date: setuptools in /home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages (from zc.lockfile->ZODB==5.0.0a6)
Collecting pycparser (from cffi; platform_python_implementation == "CPython"->persistent>=4.2.0->ZODB==5.0.0a6)
  Using cached https://files.pythonhosted.org/packages/ae/e7/d9c3a176ca4b02024debf82342dab36efadfc5776f9c8db077e8f6e71821/pycparser-2.20-py2.py3-none-any.whl
Installing collected packages: pycparser, cffi, persistent, BTrees, ZConfig, transaction, zc.lockfile, zodbpickle, ZODB
  Running setup.py develop for ZODB
Successfully installed BTrees-4.7.2 ZConfig-3.5.0 ZODB cffi-1.14.0 persistent-4.6.4 pycparser-2.20 transaction-3.0.0 zc.lockfile-2.0 zodbpickle-2.0.0

travis_time:end:215a5f7e:start=1591601585195222685,finish=1591601594922465917,duration=9727243232[0Ktravis_fold:end:install.4[0Ktravis_time:start:02889267[0K$ zope-testrunner -u --test-path=src --auto-color --auto-progress
Test-module import failures:

Module: ZODB.tests.test_datamanageradapter

Traceback (most recent call last):
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/test_datamanageradapter.py", line 16, in <module>
    from transaction._transaction import DataManagerAdapter
ImportError: cannot import name 'DataManagerAdapter'


Running zope.testrunner.layer.UnitTests tests:
  Set up zope.testrunner.layer.UnitTests in 0.000 seconds.


Failure in test _save_index (ZODB.FileStorage.tests)
Failed doctest test for ZODB.FileStorage.tests._save_index
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/tests.py", line 146, in _save_index

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/tests.py", line 178, in ZODB.FileStorage.tests._save_index
Failed example:
    pos, tid = fs._pos, fs._tid
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.FileStorage.tests._save_index[19]>", line 1, in <module>
        pos, tid = fs._pos, fs._tid
    AttributeError: 'FileStorage' object has no attribute '_tid'



Failure in test /home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/../DemoStorage.test
Failed doctest test for DemoStorage.test
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/../DemoStorage.test", line 0

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/../DemoStorage.test", line 215, in DemoStorage.test
Failed example:
    transaction.commit()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest DemoStorage.test[73]>", line 1, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
        rm.commit(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
        self._commit(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
        self._store_objects(ObjectWriter(obj), transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 565, in _store_objects
        '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 171, in storeBlob
        oid, serial, data, blobfilename, '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 713, in storeBlob
        self._blob_storeblob(oid, self._tid, blobfilename)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 748, in __getattr__
        return getattr(self.__storage, name)
    AttributeError: 'FileStorage' object has no attribute '_tid'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/../DemoStorage.test", line 226, in DemoStorage.test
Failed example:
    with conn.root()['blob'].open() as fp: fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest DemoStorage.test[80]>", line 1, in <module>
        with conn.root()['blob'].open() as fp: fp.read()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 989, in __getitem__
        raise KeyError(key)
    KeyError: 'blob'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/../DemoStorage.test", line 229, in DemoStorage.test
Failed example:
    with conn.root()['blob'].open('w') as file:
        _ = file.write(b'state 2')
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest DemoStorage.test[82]>", line 1, in <module>
        with conn.root()['blob'].open('w') as file:
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 989, in __getitem__
        raise KeyError(key)
    KeyError: 'blob'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/../DemoStorage.test", line 232, in DemoStorage.test
Failed example:
    with conn.root()['blob'].open() as fp: fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest DemoStorage.test[84]>", line 1, in <module>
        with conn.root()['blob'].open() as fp: fp.read()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 989, in __getitem__
        raise KeyError(key)
    KeyError: 'blob'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/../DemoStorage.test", line 247, in DemoStorage.test
Failed example:
    with conn.root()['blob'].open() as fp: fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest DemoStorage.test[92]>", line 1, in <module>
        with conn.root()['blob'].open() as fp: fp.read()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 989, in __getitem__
        raise KeyError(key)
    KeyError: 'blob'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/../DemoStorage.test", line 271, in DemoStorage.test
Failed example:
    with conn.root()['blob'].open() as fp: fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest DemoStorage.test[103]>", line 1, in <module>
        with conn.root()['blob'].open() as fp: fp.read()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 989, in __getitem__
        raise KeyError(key)
    KeyError: 'blob'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/../DemoStorage.test", line 274, in DemoStorage.test
Failed example:
    type(storage.changes).__name__
Expected:
    'BlobStorage'
Got:
    'MappingStorage'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/../DemoStorage.test", line 278, in DemoStorage.test
Failed example:
    with conn.root()['blob'].open('w') as file:
        _ = file.write(b'state 2')
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest DemoStorage.test[106]>", line 1, in <module>
        with conn.root()['blob'].open('w') as file:
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 989, in __getitem__
        raise KeyError(key)
    KeyError: 'blob'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/../DemoStorage.test", line 281, in DemoStorage.test
Failed example:
    with conn.root()['blob'].open() as fp: fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest DemoStorage.test[108]>", line 1, in <module>
        with conn.root()['blob'].open() as fp: fp.read()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 989, in __getitem__
        raise KeyError(key)
    KeyError: 'blob'



Error in test checkFailingCommitSticks (ZODB.tests.testZODB.ZODBTests)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testZODB.py", line 294, in checkFailingCommitSticks
    transaction.get().register(poisoned)
AttributeError: 'Transaction' object has no attribute 'register'



Error in test checkMultipleUndoInOneTransaction (ZODB.tests.testZODB.ZODBTests)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testZODB.py", line 439, in checkMultipleUndoInOneTransaction
    transaction.commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
    return self.manager.commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
    return self.get().commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
    self._commitResources()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
    rm.commit(self)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/DB.py", line 954, in commit
    self._storage.undo(tid, transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 246, in undo
    result = self._storage.undo(transaction_id, transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 923, in undo
    self._txn_undo_write(tpos, tbuf)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 962, in _txn_undo_write
    tbuf, h.oid, pos, h.tid, h.prev)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 807, in _transactionalUndoRecord
    ctid, cdataptr, current_data = tbuf.undoDataInfo(oid, tpos)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 2229, in undoDataInfo
    r = self._undoDataInfo(oid, pos)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/format.py", line 239, in _undoDataInfo
    h = self._read_data_header(pos, oid)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/format.py", line 150, in _read_data_header
    raise CorruptedDataError(oid, s, pos)
ZODB.FileStorage.format.CorruptedDataError: Error reading oid 0x00.  Found b'' at 1226

  Ran 973 tests with 2 failures, 3 errors and 0 skipped in 1 minutes 5.581 seconds.
Tearing down left over layers:
  Tear down zope.testrunner.layer.UnitTests in 0.000 seconds.

Test-modules with import problems:
  ZODB.tests.test_datamanageradapter

travis_time:end:02889267:start=1591601594932956496,finish=1591601662769920653,duration=67836964157[0K
[31;1mThe command "zope-testrunner -u --test-path=src --auto-color --auto-progress" exited with 1.[0m
travis_time:start:252631c0[0K$ zope-testrunner -f --test-path=src --auto-color --auto-progress
Test-module import failures:

Module: ZODB.tests.test_datamanageradapter

Traceback (most recent call last):
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/test_datamanageradapter.py", line 16, in <module>
    from transaction._transaction import DataManagerAdapter
ImportError: cannot import name 'DataManagerAdapter'


Running .BlobAdaptedFileStorageBlobTests tests:
  Set up .BlobAdaptedFileStorageBlobTests in 0.000 seconds.


Failure in test /home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_connection.txt
Failed doctest test for blob_connection.txt
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_connection.txt", line 0

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_connection.txt", line 28, in blob_connection.txt
Failed example:
    transaction.commit()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_connection.txt[13]>", line 1, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
        rm.commit(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
        self._commit(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
        self._store_objects(ObjectWriter(obj), transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 565, in _store_objects
        '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 171, in storeBlob
        oid, serial, data, blobfilename, '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 713, in storeBlob
        self._blob_storeblob(oid, self._tid, blobfilename)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 748, in __getattr__
        return getattr(self.__storage, name)
    AttributeError: 'FileStorage' object has no attribute '_tid'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_connection.txt", line 36, in blob_connection.txt
Failed example:
    nothing = transaction.commit()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_connection.txt[17]>", line 1, in <module>
        nothing = transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
        rm.commit(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
        self._commit(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
        self._store_objects(ObjectWriter(obj), transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 565, in _store_objects
        '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 171, in storeBlob
        oid, serial, data, blobfilename, '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 713, in storeBlob
        self._blob_storeblob(oid, self._tid, blobfilename)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 748, in __getattr__
        return getattr(self.__storage, name)
    AttributeError: 'FileStorage' object has no attribute '_tid'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_connection.txt", line 43, in blob_connection.txt
Failed example:
    blob2 = root['myblob']
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_connection.txt[21]>", line 1, in <module>
        blob2 = root['myblob']
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 989, in __getitem__
        raise KeyError(key)
    KeyError: 'myblob'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_connection.txt", line 44, in blob_connection.txt
Failed example:
    IBlob.providedBy(blob2)
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_connection.txt[22]>", line 1, in <module>
        IBlob.providedBy(blob2)
    NameError: name 'blob2' is not defined
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_connection.txt", line 46, in blob_connection.txt
Failed example:
    with blob2.open("r") as fp: fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_connection.txt[23]>", line 1, in <module>
        with blob2.open("r") as fp: fp.read()
    NameError: name 'blob2' is not defined
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_connection.txt", line 54, in blob_connection.txt
Failed example:
    f = connection.root()['myblob'].open('w')
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_connection.txt[27]>", line 1, in <module>
        f = connection.root()['myblob'].open('w')
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 989, in __getitem__
        raise KeyError(key)
    KeyError: 'myblob'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_connection.txt", line 55, in blob_connection.txt
Failed example:
    _ = f.write(b'I am an ecstatic Blob.')
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_connection.txt[28]>", line 1, in <module>
        _ = f.write(b'I am an ecstatic Blob.')
    NameError: name 'f' is not defined
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_connection.txt", line 56, in blob_connection.txt
Failed example:
    f.close()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_connection.txt[29]>", line 1, in <module>
        f.close()
    NameError: name 'f' is not defined
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_connection.txt", line 57, in blob_connection.txt
Failed example:
    transaction.commit()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_connection.txt[30]>", line 1, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 265, in commit
        self._prior_operation_failed() # doesn't return
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 178, in _prior_operation_failed
        self._failure_traceback.getvalue())
    transaction.interfaces.TransactionFailedError: An operation previously failed, with traceback:

      File "/home/travis/virtualenv/python3.5.6/bin/zope-testrunner", line 11, in <module>
        sys.exit(run())
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 27, in run
        failed = run_internal(defaults, args, script_parts=script_parts, cwd=cwd)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 44, in run_internal
        runner.run()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 171, in run
        self.run_tests()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 253, in run_tests
        self.skipped, self.import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 425, in run_layer
        import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 345, in run_tests
        test(result)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 653, in __call__
        return self.run(*args, **kwds)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
        testMethod()
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 2185, in runTest
        test, out=new.write, clear_globs=False)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1467, in run
        return self.__run(test, compileflags, out)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_connection.txt[17]>", line 1, in <module>
        nothing = transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 280, in commit
        t, v, tb = self._saveAndGetCommitishError()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
        rm.commit(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
        self._commit(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
        self._store_objects(ObjectWriter(obj), transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 565, in _store_objects
        '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 171, in storeBlob
        oid, serial, data, blobfilename, '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 713, in storeBlob
        self._blob_storeblob(oid, self._tid, blobfilename)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 748, in __getattr__
        return getattr(self.__storage, name)
    AttributeError: 'FileStorage' object has no attribute '_tid'

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_connection.txt", line 58, in blob_connection.txt
Failed example:
    with connection3.root()['myblob'].open('r') as fp: fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_connection.txt[31]>", line 1, in <module>
        with connection3.root()['myblob'].open('r') as fp: fp.read()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 989, in __getitem__
        raise KeyError(key)
    KeyError: 'myblob'



Failure in test /home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_importexport.txt
Failed doctest test for blob_importexport.txt
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_importexport.txt", line 0

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_importexport.txt", line 33, in blob_importexport.txt
Failed example:
    transaction.commit()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_importexport.txt[16]>", line 1, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
        rm.commit(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
        self._commit(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
        self._store_objects(ObjectWriter(obj), transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 565, in _store_objects
        '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 171, in storeBlob
        oid, serial, data, blobfilename, '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 713, in storeBlob
        self._blob_storeblob(oid, self._tid, blobfilename)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 748, in __getattr__
        return getattr(self.__storage, name)
    AttributeError: 'FileStorage' object has no attribute '_tid'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_importexport.txt", line 37, in blob_importexport.txt
Failed example:
    conn = root1['blobdata']._p_jar
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_importexport.txt[17]>", line 1, in <module>
        conn = root1['blobdata']._p_jar
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 989, in __getitem__
        raise KeyError(key)
    KeyError: 'blobdata'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_importexport.txt", line 38, in blob_importexport.txt
Failed example:
    oid = root1['blobdata']._p_oid
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_importexport.txt[18]>", line 1, in <module>
        oid = root1['blobdata']._p_oid
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 989, in __getitem__
        raise KeyError(key)
    KeyError: 'blobdata'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_importexport.txt", line 40, in blob_importexport.txt
Failed example:
    connection1.exportFile(oid, exportfile).close()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_importexport.txt[20]>", line 1, in <module>
        connection1.exportFile(oid, exportfile).close()
    NameError: name 'oid' is not defined
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_importexport.txt", line 47, in blob_importexport.txt
Failed example:
    data = root2._p_jar.importFile(exportfile)
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_importexport.txt[24]>", line 1, in <module>
        data = root2._p_jar.importFile(exportfile)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/ExportImport.py", line 77, in importFile
        with open(f, 'rb') as fp:
    FileNotFoundError: [Errno 2] No such file or directory: 'export'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_importexport.txt", line 48, in blob_importexport.txt
Failed example:
    root2['blobdata'] = data
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_importexport.txt[25]>", line 1, in <module>
        root2['blobdata'] = data
    NameError: name 'data' is not defined
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_importexport.txt", line 53, in blob_importexport.txt
Failed example:
    items1 = root1['blobdata']
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_importexport.txt[27]>", line 1, in <module>
        items1 = root1['blobdata']
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 989, in __getitem__
        raise KeyError(key)
    KeyError: 'blobdata'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_importexport.txt", line 54, in blob_importexport.txt
Failed example:
    items2 = root2['blobdata']
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_importexport.txt[28]>", line 1, in <module>
        items2 = root2['blobdata']
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 989, in __getitem__
        raise KeyError(key)
    KeyError: 'blobdata'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_importexport.txt", line 55, in blob_importexport.txt
Failed example:
    bool(items1.keys() == items2.keys())
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_importexport.txt[29]>", line 1, in <module>
        bool(items1.keys() == items2.keys())
    NameError: name 'items1' is not defined
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_importexport.txt", line 57, in blob_importexport.txt
Failed example:
    with items1['blob1'].open() as fp1:
        with items2['blob1'].open() as fp2:
            fp1.read() == fp2.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_importexport.txt[30]>", line 1, in <module>
        with items1['blob1'].open() as fp1:
    NameError: name 'items1' is not defined
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_importexport.txt", line 61, in blob_importexport.txt
Failed example:
    with items1['blob2'].open() as fp1:
        with items2['blob2'].open() as fp2:
            fp1.read() == fp2.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_importexport.txt[31]>", line 1, in <module>
        with items1['blob2'].open() as fp1:
    NameError: name 'items1' is not defined



Failure in test /home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt
Failed doctest test for blob_transaction.txt
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 0

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 44, in blob_transaction.txt
Failed example:
    transaction.commit()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[19]>", line 1, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
        rm.commit(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
        self._commit(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
        self._store_objects(ObjectWriter(obj), transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 565, in _store_objects
        '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 171, in storeBlob
        oid, serial, data, blobfilename, '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 713, in storeBlob
        self._blob_storeblob(oid, self._tid, blobfilename)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 748, in __getattr__
        return getattr(self.__storage, name)
    AttributeError: 'FileStorage' object has no attribute '_tid'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 49, in blob_transaction.txt
Failed example:
    os.path.exists(fname)
Expected:
    False
Got:
    True
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 53, in blob_transaction.txt
Failed example:
    with blob1.open('w') as file:
        _ = file.write(b'this is new blob 1')
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[22]>", line 1, in <module>
        with blob1.open('w') as file:
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 210, in open
        self._p_changed = True
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 792, in register
        self._register(obj)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 802, in _register
        self.transaction_manager.get().join(self)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 184, in join
        self._prior_operation_failed() # doesn't return
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 178, in _prior_operation_failed
        self._failure_traceback.getvalue())
    transaction.interfaces.TransactionFailedError: An operation previously failed, with traceback:

      File "/home/travis/virtualenv/python3.5.6/bin/zope-testrunner", line 11, in <module>
        sys.exit(run())
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 27, in run
        failed = run_internal(defaults, args, script_parts=script_parts, cwd=cwd)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 44, in run_internal
        runner.run()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 171, in run
        self.run_tests()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 253, in run_tests
        self.skipped, self.import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 425, in run_layer
        import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 345, in run_tests
        test(result)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 653, in __call__
        return self.run(*args, **kwds)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
        testMethod()
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 2185, in runTest
        test, out=new.write, clear_globs=False)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1467, in run
        return self.__run(test, compileflags, out)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[19]>", line 1, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 280, in commit
        t, v, tb = self._saveAndGetCommitishError()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
        rm.commit(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
        self._commit(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
        self._store_objects(ObjectWriter(obj), transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 565, in _store_objects
        '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 171, in storeBlob
        oid, serial, data, blobfilename, '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 713, in storeBlob
        self._blob_storeblob(oid, self._tid, blobfilename)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 748, in __getattr__
        return getattr(self.__storage, name)
    AttributeError: 'FileStorage' object has no attribute '_tid'

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 55, in blob_transaction.txt
Failed example:
    with blob1.open() as fp:
        fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[23]>", line 1, in <module>
        with blob1.open() as fp:
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 152, in open
        raise BlobError("Already opened for writing.")
    ZODB.interfaces.BlobError: Already opened for writing.
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 63, in blob_transaction.txt
Failed example:
    os.path.exists(fname)
Expected:
    False
Got:
    True
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 65, in blob_transaction.txt
Failed example:
    blob1._p_blob_uncommitted
Expected nothing
Got:
    '/tmp/testorlixdrw/blobs/tmp/BUCrp3dixi3'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 67, in blob_transaction.txt
Failed example:
    with blob1.open() as fp:
        fp.read()
Expected:
    'this is blob 1'
Got:
    ''
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 76, in blob_transaction.txt
Failed example:
    blob1a = root2['blob1']
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[32]>", line 1, in <module>
        blob1a = root2['blob1']
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 989, in __getitem__
        raise KeyError(key)
    KeyError: 'blob1'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 78, in blob_transaction.txt
Failed example:
    blob1afh1 = blob1a.open("r")
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[33]>", line 1, in <module>
        blob1afh1 = blob1a.open("r")
    NameError: name 'blob1a' is not defined
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 79, in blob_transaction.txt
Failed example:
    blob1afh1.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[34]>", line 1, in <module>
        blob1afh1.read()
    NameError: name 'blob1afh1' is not defined
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 85, in blob_transaction.txt
Failed example:
    blob1afh2 = blob1a.open("r")
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[35]>", line 1, in <module>
        blob1afh2 = blob1a.open("r")
    NameError: name 'blob1a' is not defined
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 86, in blob_transaction.txt
Failed example:
    blob1afh2.blob is blob1afh1.blob
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[36]>", line 1, in <module>
        blob1afh2.blob is blob1afh1.blob
    NameError: name 'blob1afh2' is not defined
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 91, in blob_transaction.txt
Failed example:
    blob1afh1.close()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[37]>", line 1, in <module>
        blob1afh1.close()
    NameError: name 'blob1afh1' is not defined
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 97, in blob_transaction.txt
Failed example:
    blob1afh2.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[39]>", line 1, in <module>
        blob1afh2.read()
    NameError: name 'blob1afh2' is not defined
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 100, in blob_transaction.txt
Failed example:
    blob1afh2.close()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[40]>", line 1, in <module>
        blob1afh2.close()
    NameError: name 'blob1afh2' is not defined
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 107, in blob_transaction.txt
Failed example:
    bool(blob1a._p_changed)
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[41]>", line 1, in <module>
        bool(blob1a._p_changed)
    NameError: name 'blob1a' is not defined
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 109, in blob_transaction.txt
Failed example:
    with blob1a.open('r') as fp:
        fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[42]>", line 1, in <module>
        with blob1a.open('r') as fp:
    NameError: name 'blob1a' is not defined
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 112, in blob_transaction.txt
Failed example:
    with blob1a.open('a') as blob1afh3:
        assert(bool(blob1a._p_changed))
        _ = blob1afh3.write(b'woot!')
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[43]>", line 1, in <module>
        with blob1a.open('a') as blob1afh3:
    NameError: name 'blob1a' is not defined
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 115, in blob_transaction.txt
Failed example:
    blob1afh3.close()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[44]>", line 1, in <module>
        blob1afh3.close()
    NameError: name 'blob1afh3' is not defined
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 124, in blob_transaction.txt
Failed example:
    transaction.commit()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[48]>", line 1, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
        rm.commit(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
        self._commit(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
        self._store_objects(ObjectWriter(obj), transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 565, in _store_objects
        '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 171, in storeBlob
        oid, serial, data, blobfilename, '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 713, in storeBlob
        self._blob_storeblob(oid, self._tid, blobfilename)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 748, in __getattr__
        return getattr(self.__storage, name)
    AttributeError: 'FileStorage' object has no attribute '_tid'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 130, in blob_transaction.txt
Failed example:
    with blob1.open('r') as fp:
        fp.read()
Expected:
    'this is blob 1woot!'
Got:
    ''
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 133, in blob_transaction.txt
Failed example:
    with blob1a.open('r') as fp:
        fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[50]>", line 1, in <module>
        with blob1a.open('r') as fp:
    NameError: name 'blob1a' is not defined
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 136, in blob_transaction.txt
Failed example:
    with blob2.open('r') as fp:
        fp.read()
Expected:
    'this is blob 3'
Got:
    ''
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 145, in blob_transaction.txt
Failed example:
    with blob1.open('r') as f:
        root1['wontwork'] = f
        transaction.commit()
Expected:
    Traceback (most recent call last):
    ...
    TypeError: ...
Got:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[52]>", line 2, in <module>
        root1['wontwork'] = f
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/persistent/mapping.py", line 85, in __setitem__
        self._p_changed = 1
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 792, in register
        self._register(obj)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 802, in _register
        self.transaction_manager.get().join(self)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 184, in join
        self._prior_operation_failed() # doesn't return
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 178, in _prior_operation_failed
        self._failure_traceback.getvalue())
    transaction.interfaces.TransactionFailedError: An operation previously failed, with traceback:
    <BLANKLINE>
      File "/home/travis/virtualenv/python3.5.6/bin/zope-testrunner", line 11, in <module>
        sys.exit(run())
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 27, in run
        failed = run_internal(defaults, args, script_parts=script_parts, cwd=cwd)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 44, in run_internal
        runner.run()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 171, in run
        self.run_tests()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 253, in run_tests
        self.skipped, self.import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 425, in run_layer
        import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 345, in run_tests
        test(result)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 653, in __call__
        return self.run(*args, **kwds)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
        testMethod()
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 2185, in runTest
        test, out=new.write, clear_globs=False)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1467, in run
        return self.__run(test, compileflags, out)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[48]>", line 1, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 280, in commit
        t, v, tb = self._saveAndGetCommitishError()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
        rm.commit(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
        self._commit(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
        self._store_objects(ObjectWriter(obj), transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 565, in _store_objects
        '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 171, in storeBlob
        oid, serial, data, blobfilename, '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 713, in storeBlob
        self._blob_storeblob(oid, self._tid, blobfilename)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 748, in __getattr__
        return getattr(self.__storage, name)
    AttributeError: 'FileStorage' object has no attribute '_tid'
    <BLANKLINE>
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 163, in blob_transaction.txt
Failed example:
    blob1c3 = root3['blob1']
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[58]>", line 1, in <module>
        blob1c3 = root3['blob1']
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 989, in __getitem__
        raise KeyError(key)
    KeyError: 'blob1'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 164, in blob_transaction.txt
Failed example:
    blob1c4 = root4['blob1']
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[59]>", line 1, in <module>
        blob1c4 = root4['blob1']
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 989, in __getitem__
        raise KeyError(key)
    KeyError: 'blob1'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 165, in blob_transaction.txt
Failed example:
    with blob1c3.open('a') as blob1c3fh1:
        _ = blob1c3fh1.write(b'this is from connection 3')
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[60]>", line 1, in <module>
        with blob1c3.open('a') as blob1c3fh1:
    NameError: name 'blob1c3' is not defined
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 167, in blob_transaction.txt
Failed example:
    with blob1c4.open('a') as blob1c4fh1:
        _ = blob1c4fh1.write(b'this is from connection 4')
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[61]>", line 1, in <module>
        with blob1c4.open('a') as blob1c4fh1:
    NameError: name 'blob1c4' is not defined
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 170, in blob_transaction.txt
Failed example:
    with root3['blob1'].open('r') as fp:
        fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[63]>", line 1, in <module>
        with root3['blob1'].open('r') as fp:
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 989, in __getitem__
        raise KeyError(key)
    KeyError: 'blob1'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 173, in blob_transaction.txt
Failed example:
    tm2.commit()
Expected:
    Traceback (most recent call last):
        ...
    ConflictError: database conflict error (oid 0x01, class ZODB.blob.Blob...)
Got nothing
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 181, in blob_transaction.txt
Failed example:
    with root3['blob1'].open('r') as fp:
        fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[65]>", line 1, in <module>
        with root3['blob1'].open('r') as fp:
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 989, in __getitem__
        raise KeyError(key)
    KeyError: 'blob1'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 185, in blob_transaction.txt
Failed example:
    with root4['blob1'].open('r') as fp:
        fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[67]>", line 1, in <module>
        with root4['blob1'].open('r') as fp:
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 989, in __getitem__
        raise KeyError(key)
    KeyError: 'blob1'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 191, in blob_transaction.txt
Failed example:
    f = root3['blob1'].open('w')
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[68]>", line 1, in <module>
        f = root3['blob1'].open('w')
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 989, in __getitem__
        raise KeyError(key)
    KeyError: 'blob1'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 192, in blob_transaction.txt
Failed example:
    tm1.commit()
Expected:
    Traceback (most recent call last):
    ...
    ValueError: Can't commit with opened blobs.
Got nothing
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 199, in blob_transaction.txt
Failed example:
    f = root3['blob1'].open('w')
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[72]>", line 1, in <module>
        f = root3['blob1'].open('w')
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 989, in __getitem__
        raise KeyError(key)
    KeyError: 'blob1'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 202, in blob_transaction.txt
Failed example:
    f = root3['blob1'].open('r')
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[74]>", line 1, in <module>
        f = root3['blob1'].open('r')
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 989, in __getitem__
        raise KeyError(key)
    KeyError: 'blob1'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 203, in blob_transaction.txt
Failed example:
    tm1.commit()
Expected:
    Traceback (most recent call last):
    ...
    ValueError: Can't commit with opened blobs.
Got nothing
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 221, in blob_transaction.txt
Failed example:
    transaction.commit()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[83]>", line 1, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
        rm.commit(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
        self._commit(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
        self._store_objects(ObjectWriter(obj), transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 565, in _store_objects
        '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 171, in storeBlob
        oid, serial, data, blobfilename, '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 713, in storeBlob
        self._blob_storeblob(oid, self._tid, blobfilename)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 748, in __getattr__
        return getattr(self.__storage, name)
    AttributeError: 'FileStorage' object has no attribute '_tid'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 222, in blob_transaction.txt
Failed example:
    with root5['blob'].open("r") as fp:
        fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[84]>", line 1, in <module>
        with root5['blob'].open("r") as fp:
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 989, in __getitem__
        raise KeyError(key)
    KeyError: 'blob'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 225, in blob_transaction.txt
Failed example:
    with root5['blob'].open("a") as blob_fh:
        _ = blob_fh.write(b" And I'm singing.")
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[85]>", line 1, in <module>
        with root5['blob'].open("a") as blob_fh:
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 989, in __getitem__
        raise KeyError(key)
    KeyError: 'blob'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 227, in blob_transaction.txt
Failed example:
    with root5['blob'].open("r") as fp:
        fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[86]>", line 1, in <module>
        with root5['blob'].open("r") as fp:
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 989, in __getitem__
        raise KeyError(key)
    KeyError: 'blob'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 230, in blob_transaction.txt
Failed example:
    savepoint = transaction.savepoint(optimistic=True)
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[87]>", line 1, in <module>
        savepoint = transaction.savepoint(optimistic=True)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 272, in savepoint
        return self.manager.savepoint(optimistic)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 151, in savepoint
        return self.get().savepoint(optimistic)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 221, in savepoint
        self._prior_operation_failed() # doesn't return, it raises
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 178, in _prior_operation_failed
        self._failure_traceback.getvalue())
    transaction.interfaces.TransactionFailedError: An operation previously failed, with traceback:

      File "/home/travis/virtualenv/python3.5.6/bin/zope-testrunner", line 11, in <module>
        sys.exit(run())
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 27, in run
        failed = run_internal(defaults, args, script_parts=script_parts, cwd=cwd)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 44, in run_internal
        runner.run()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 171, in run
        self.run_tests()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 253, in run_tests
        self.skipped, self.import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 425, in run_layer
        import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 345, in run_tests
        test(result)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 653, in __call__
        return self.run(*args, **kwds)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
        testMethod()
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 2185, in runTest
        test, out=new.write, clear_globs=False)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1467, in run
        return self.__run(test, compileflags, out)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[83]>", line 1, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 280, in commit
        t, v, tb = self._saveAndGetCommitishError()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
        rm.commit(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
        self._commit(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
        self._store_objects(ObjectWriter(obj), transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 565, in _store_objects
        '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 171, in storeBlob
        oid, serial, data, blobfilename, '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 713, in storeBlob
        self._blob_storeblob(oid, self._tid, blobfilename)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 748, in __getattr__
        return getattr(self.__storage, name)
    AttributeError: 'FileStorage' object has no attribute '_tid'

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 232, in blob_transaction.txt
Failed example:
    with root5['blob'].open("r") as fp:
        fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[88]>", line 1, in <module>
        with root5['blob'].open("r") as fp:
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 989, in __getitem__
        raise KeyError(key)
    KeyError: 'blob'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 239, in blob_transaction.txt
Failed example:
    len([name for name in os.listdir(os.path.join(blob_dir, 'tmp'))
         if name.startswith('savepoint')])
Expected:
    1
Got:
    0
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 246, in blob_transaction.txt
Failed example:
    transaction.commit()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[90]>", line 1, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 265, in commit
        self._prior_operation_failed() # doesn't return
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 178, in _prior_operation_failed
        self._failure_traceback.getvalue())
    transaction.interfaces.TransactionFailedError: An operation previously failed, with traceback:

      File "/home/travis/virtualenv/python3.5.6/bin/zope-testrunner", line 11, in <module>
        sys.exit(run())
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 27, in run
        failed = run_internal(defaults, args, script_parts=script_parts, cwd=cwd)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 44, in run_internal
        runner.run()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 171, in run
        self.run_tests()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 253, in run_tests
        self.skipped, self.import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 425, in run_layer
        import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 345, in run_tests
        test(result)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 653, in __call__
        return self.run(*args, **kwds)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
        testMethod()
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 2185, in runTest
        test, out=new.write, clear_globs=False)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1467, in run
        return self.__run(test, compileflags, out)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[83]>", line 1, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 280, in commit
        t, v, tb = self._saveAndGetCommitishError()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
        rm.commit(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
        self._commit(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
        self._store_objects(ObjectWriter(obj), transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 565, in _store_objects
        '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 171, in storeBlob
        oid, serial, data, blobfilename, '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 713, in storeBlob
        self._blob_storeblob(oid, self._tid, blobfilename)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 748, in __getattr__
        return getattr(self.__storage, name)
    AttributeError: 'FileStorage' object has no attribute '_tid'

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 253, in blob_transaction.txt
Failed example:
    with root5['blob'].open("a") as file:
        _ = file.write(b" And I'm dancing.")
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[92]>", line 1, in <module>
        with root5['blob'].open("a") as file:
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 989, in __getitem__
        raise KeyError(key)
    KeyError: 'blob'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 255, in blob_transaction.txt
Failed example:
    with root5['blob'].open("r") as fp:
        fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[93]>", line 1, in <module>
        with root5['blob'].open("r") as fp:
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 989, in __getitem__
        raise KeyError(key)
    KeyError: 'blob'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 258, in blob_transaction.txt
Failed example:
    savepoint = transaction.savepoint()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[94]>", line 1, in <module>
        savepoint = transaction.savepoint()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 272, in savepoint
        return self.manager.savepoint(optimistic)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 151, in savepoint
        return self.get().savepoint(optimistic)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 221, in savepoint
        self._prior_operation_failed() # doesn't return, it raises
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 178, in _prior_operation_failed
        self._failure_traceback.getvalue())
    transaction.interfaces.TransactionFailedError: An operation previously failed, with traceback:

      File "/home/travis/virtualenv/python3.5.6/bin/zope-testrunner", line 11, in <module>
        sys.exit(run())
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 27, in run
        failed = run_internal(defaults, args, script_parts=script_parts, cwd=cwd)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 44, in run_internal
        runner.run()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 171, in run
        self.run_tests()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 253, in run_tests
        self.skipped, self.import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 425, in run_layer
        import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 345, in run_tests
        test(result)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 653, in __call__
        return self.run(*args, **kwds)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
        testMethod()
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 2185, in runTest
        test, out=new.write, clear_globs=False)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1467, in run
        return self.__run(test, compileflags, out)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[83]>", line 1, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 280, in commit
        t, v, tb = self._saveAndGetCommitishError()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
        rm.commit(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
        self._commit(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
        self._store_objects(ObjectWriter(obj), transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 565, in _store_objects
        '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 171, in storeBlob
        oid, serial, data, blobfilename, '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 713, in storeBlob
        self._blob_storeblob(oid, self._tid, blobfilename)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 748, in __getattr__
        return getattr(self.__storage, name)
    AttributeError: 'FileStorage' object has no attribute '_tid'

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 262, in blob_transaction.txt
Failed example:
    len([name for name in os.listdir(os.path.join(blob_dir, 'tmp'))
         if name.startswith('savepoint')])
Expected:
    1
Got:
    0
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 266, in blob_transaction.txt
Failed example:
    with root5['blob'].open("w") as file:
        _ = file.write(b" And the weather is beautiful.")
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[96]>", line 1, in <module>
        with root5['blob'].open("w") as file:
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 989, in __getitem__
        raise KeyError(key)
    KeyError: 'blob'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 268, in blob_transaction.txt
Failed example:
    savepoint.rollback()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[97]>", line 1, in <module>
        savepoint.rollback()
    NameError: name 'savepoint' is not defined
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 270, in blob_transaction.txt
Failed example:
    with root5['blob'].open("r") as fp:
        fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[98]>", line 1, in <module>
        with root5['blob'].open("r") as fp:
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 989, in __getitem__
        raise KeyError(key)
    KeyError: 'blob'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 294, in blob_transaction.txt
Failed example:
    transaction.commit()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[106]>", line 1, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
        rm.commit(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
        self._commit(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
        self._store_objects(ObjectWriter(obj), transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 565, in _store_objects
        '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 171, in storeBlob
        oid, serial, data, blobfilename, '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 713, in storeBlob
        self._blob_storeblob(oid, self._tid, blobfilename)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 748, in __getattr__
        return getattr(self.__storage, name)
    AttributeError: 'FileStorage' object has no attribute '_tid'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 295, in blob_transaction.txt
Failed example:
    with open(blob.committed()) as fp:
        fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[107]>", line 1, in <module>
        with open(blob.committed()) as fp:
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 221, in committed
        raise BlobError('Uncommitted changes')
    ZODB.interfaces.BlobError: Uncommitted changes
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 301, in blob_transaction.txt
Failed example:
    f = blob.open('c')
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[108]>", line 1, in <module>
        f = blob.open('c')
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 147, in open
        raise BlobError('Uncommitted changes')
    ZODB.interfaces.BlobError: Uncommitted changes
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 305, in blob_transaction.txt
Failed example:
    type(f) == file_type
Expected:
    True
Got:
    False
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 310, in blob_transaction.txt
Failed example:
    with blob.open('w') as file:
        _ = file.write(b'x')
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[110]>", line 1, in <module>
        with blob.open('w') as file:
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 210, in open
        self._p_changed = True
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 792, in register
        self._register(obj)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 802, in _register
        self.transaction_manager.get().join(self)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 184, in join
        self._prior_operation_failed() # doesn't return
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 178, in _prior_operation_failed
        self._failure_traceback.getvalue())
    transaction.interfaces.TransactionFailedError: An operation previously failed, with traceback:

      File "/home/travis/virtualenv/python3.5.6/bin/zope-testrunner", line 11, in <module>
        sys.exit(run())
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 27, in run
        failed = run_internal(defaults, args, script_parts=script_parts, cwd=cwd)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 44, in run_internal
        runner.run()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 171, in run
        self.run_tests()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 253, in run_tests
        self.skipped, self.import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 425, in run_layer
        import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 345, in run_tests
        test(result)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 653, in __call__
        return self.run(*args, **kwds)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
        testMethod()
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 2185, in runTest
        test, out=new.write, clear_globs=False)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1467, in run
        return self.__run(test, compileflags, out)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[106]>", line 1, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 280, in commit
        t, v, tb = self._saveAndGetCommitishError()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
        rm.commit(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
        self._commit(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
        self._store_objects(ObjectWriter(obj), transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 565, in _store_objects
        '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 171, in storeBlob
        oid, serial, data, blobfilename, '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 713, in storeBlob
        self._blob_storeblob(oid, self._tid, blobfilename)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 748, in __getattr__
        return getattr(self.__storage, name)
    AttributeError: 'FileStorage' object has no attribute '_tid'

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 312, in blob_transaction.txt
Failed example:
    with blob.open() as fp: fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[111]>", line 1, in <module>
        with blob.open() as fp: fp.read()
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 152, in open
        raise BlobError("Already opened for writing.")
    ZODB.interfaces.BlobError: Already opened for writing.
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 315, in blob_transaction.txt
Failed example:
    f.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[112]>", line 1, in <module>
        f.read()
    ValueError: I/O operation on closed file
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 359, in blob_transaction.txt
Failed example:
    transaction.commit()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[125]>", line 1, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
        rm.commit(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 462, in commit
        self._commit_savepoint(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 1004, in _commit_savepoint
        '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 171, in storeBlob
        oid, serial, data, blobfilename, '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 713, in storeBlob
        self._blob_storeblob(oid, self._tid, blobfilename)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 748, in __getattr__
        return getattr(self.__storage, name)
    AttributeError: 'FileStorage' object has no attribute '_tid'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 360, in blob_transaction.txt
Failed example:
    with open(blob.committed()) as fp:
        fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[126]>", line 1, in <module>
        with open(blob.committed()) as fp:
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 221, in committed
        raise BlobError('Uncommitted changes')
    ZODB.interfaces.BlobError: Uncommitted changes
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 379, in blob_transaction.txt
Failed example:
    olddata, oldserial = blob_storage.load(blob._p_oid, '')
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[128]>", line 1, in <module>
        olddata, oldserial = blob_storage.load(blob._p_oid, '')
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 446, in load
        pos = self._lookup_pos(oid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 433, in _lookup_pos
        return self._index[oid]
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/fsIndex.py", line 108, in __getitem__
        assert isinstance(key, bytes)
    AssertionError
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 384, in blob_transaction.txt
Failed example:
    blob_storage.storeBlob(blob._p_oid, oldserial, olddata, 'blobfile',
                                '', t)
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[132]>", line 1, in <module>
        blob_storage.storeBlob(blob._p_oid, oldserial, olddata, 'blobfile',
    NameError: name 'oldserial' is not defined
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 389, in blob_transaction.txt
Failed example:
    blob_storage.storeBlob(new_oid, '\0'*8, olddata, 'blobfile2',
                                '', t)
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[135]>", line 1, in <module>
        blob_storage.storeBlob(new_oid, '\0'*8, olddata, 'blobfile2',
    NameError: name 'olddata' is not defined
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 397, in blob_transaction.txt
Failed example:
    blob_storage.load(blob._p_oid, '') == (olddata, oldserial)
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[138]>", line 1, in <module>
        blob_storage.load(blob._p_oid, '') == (olddata, oldserial)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 446, in load
        pos = self._lookup_pos(oid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 433, in _lookup_pos
        return self._index[oid]
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/fsIndex.py", line 108, in __getitem__
        assert isinstance(key, bytes)
    AssertionError
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 402, in blob_transaction.txt
Failed example:
    with open(blob_storage.loadBlob(blob._p_oid, oldserial)) as fp:
        fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[139]>", line 1, in <module>
        with open(blob_storage.loadBlob(blob._p_oid, oldserial)) as fp:
    NameError: name 'oldserial' is not defined



Failure in test /home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_packing.txt
Failed doctest test for blob_packing.txt
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_packing.txt", line 0

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_packing.txt", line 36, in blob_packing.txt
Failed example:
    for i in range(5):
        _ = transaction.begin()
        times.append(new_time())
        with blob.open('w') as file:
            _ = file.write(b'this is blob data ' + str(i).encode())
        if i:
            tids.append(blob._p_serial)
        else:
            root['blob'] = blob
        transaction.commit()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_packing.txt[14]>", line 10, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
        rm.commit(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
        self._commit(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
        self._store_objects(ObjectWriter(obj), transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 565, in _store_objects
        '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 171, in storeBlob
        oid, serial, data, blobfilename, '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 713, in storeBlob
        self._blob_storeblob(oid, self._tid, blobfilename)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 748, in __getattr__
        return getattr(self.__storage, name)
    AttributeError: 'FileStorage' object has no attribute '_tid'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_packing.txt", line 50, in blob_packing.txt
Failed example:
    oid = root['blob']._p_oid
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_packing.txt[17]>", line 1, in <module>
        oid = root['blob']._p_oid
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 989, in __getitem__
        raise KeyError(key)
    KeyError: 'blob'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_packing.txt", line 51, in blob_packing.txt
Failed example:
    fns = [ blob_storage.fshelper.getBlobFilename(oid, x) for x in tids ]
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_packing.txt[18]>", line 1, in <module>
        fns = [ blob_storage.fshelper.getBlobFilename(oid, x) for x in tids ]
      File "<doctest blob_packing.txt[18]>", line 1, in <listcomp>
        fns = [ blob_storage.fshelper.getBlobFilename(oid, x) for x in tids ]
    NameError: name 'oid' is not defined
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_packing.txt", line 52, in blob_packing.txt
Failed example:
    [ os.path.exists(x) for x in fns ] # no pack
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_packing.txt[19]>", line 1, in <module>
        [ os.path.exists(x) for x in fns ] # no pack
    NameError: name 'fns' is not defined
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_packing.txt", line 59, in blob_packing.txt
Failed example:
    [ os.path.exists(x) for x in fns ]
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_packing.txt[22]>", line 1, in <module>
        [ os.path.exists(x) for x in fns ]
    NameError: name 'fns' is not defined
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_packing.txt", line 64, in blob_packing.txt
Failed example:
    packtime = times[1]
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_packing.txt[23]>", line 1, in <module>
        packtime = times[1]
    IndexError: list index out of range
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_packing.txt", line 66, in blob_packing.txt
Failed example:
    [ os.path.exists(x) for x in fns ]
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_packing.txt[25]>", line 1, in <module>
        [ os.path.exists(x) for x in fns ]
    NameError: name 'fns' is not defined
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_packing.txt", line 71, in blob_packing.txt
Failed example:
    packtime = times[2]
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_packing.txt[26]>", line 1, in <module>
        packtime = times[2]
    IndexError: list index out of range
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_packing.txt", line 73, in blob_packing.txt
Failed example:
    [ os.path.exists(x) for x in fns ]
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_packing.txt[28]>", line 1, in <module>
        [ os.path.exists(x) for x in fns ]
    NameError: name 'fns' is not defined
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_packing.txt", line 78, in blob_packing.txt
Failed example:
    packtime = times[3]
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_packing.txt[29]>", line 1, in <module>
        packtime = times[3]
    IndexError: list index out of range
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_packing.txt", line 80, in blob_packing.txt
Failed example:
    [ os.path.exists(x) for x in fns ]
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_packing.txt[31]>", line 1, in <module>
        [ os.path.exists(x) for x in fns ]
    NameError: name 'fns' is not defined
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_packing.txt", line 85, in blob_packing.txt
Failed example:
    packtime = times[4]
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_packing.txt[32]>", line 1, in <module>
        packtime = times[4]
    IndexError: list index out of range
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_packing.txt", line 87, in blob_packing.txt
Failed example:
    [ os.path.exists(x) for x in fns ]
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_packing.txt[34]>", line 1, in <module>
        [ os.path.exists(x) for x in fns ]
    NameError: name 'fns' is not defined
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_packing.txt", line 94, in blob_packing.txt
Failed example:
    [ os.path.exists(x) for x in fns ]
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_packing.txt[37]>", line 1, in <module>
        [ os.path.exists(x) for x in fns ]
    NameError: name 'fns' is not defined
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_packing.txt", line 101, in blob_packing.txt
Failed example:
    del root['blob']
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_packing.txt[39]>", line 1, in <module>
        del root['blob']
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/persistent/mapping.py", line 80, in __delitem__
        self.__super_delitem(key)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 991, in __delitem__
        def __delitem__(self, key): del self.data[key]
    KeyError: 'blob'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_packing.txt", line 105, in blob_packing.txt
Failed example:
    [ os.path.exists(x) for x in fns ]
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_packing.txt[43]>", line 1, in <module>
        [ os.path.exists(x) for x in fns ]
    NameError: name 'fns' is not defined
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_packing.txt", line 107, in blob_packing.txt
Failed example:
    os.path.exists(os.path.split(fns[0])[0])
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_packing.txt[44]>", line 1, in <module>
        os.path.exists(os.path.split(fns[0])[0])
    NameError: name 'fns' is not defined



Failure in test commit_from_wrong_partition (ZODB.tests.testblob)
Failed doctest test for ZODB.tests.testblob.commit_from_wrong_partition
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 367, in commit_from_wrong_partition

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 395, in ZODB.tests.testblob.commit_from_wrong_partition
Failed example:
    transaction.commit() # doctest: +ELLIPSIS
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.commit_from_wrong_partition[16]>", line 1, in <module>
        transaction.commit() # doctest: +ELLIPSIS
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
        rm.commit(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
        self._commit(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
        self._store_objects(ObjectWriter(obj), transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 565, in _store_objects
        '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 171, in storeBlob
        oid, serial, data, blobfilename, '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 713, in storeBlob
        self._blob_storeblob(oid, self._tid, blobfilename)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 748, in __getattr__
        return getattr(self.__storage, name)
    AttributeError: 'FileStorage' object has no attribute '_tid'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 398, in ZODB.tests.testblob.commit_from_wrong_partition
Failed example:
    with root['blob'].open() as fp: fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.commit_from_wrong_partition[17]>", line 1, in <module>
        with root['blob'].open() as fp: fp.read()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 989, in __getitem__
        raise KeyError(key)
    KeyError: 'blob'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 403, in ZODB.tests.testblob.commit_from_wrong_partition
Failed example:
    root['blob2'] = Blob()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.commit_from_wrong_partition[18]>", line 1, in <module>
        root['blob2'] = Blob()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/persistent/mapping.py", line 85, in __setitem__
        self._p_changed = 1
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 792, in register
        self._register(obj)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 802, in _register
        self.transaction_manager.get().join(self)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 184, in join
        self._prior_operation_failed() # doesn't return
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 178, in _prior_operation_failed
        self._failure_traceback.getvalue())
    transaction.interfaces.TransactionFailedError: An operation previously failed, with traceback:

      File "/home/travis/virtualenv/python3.5.6/bin/zope-testrunner", line 11, in <module>
        sys.exit(run())
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 27, in run
        failed = run_internal(defaults, args, script_parts=script_parts, cwd=cwd)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 44, in run_internal
        runner.run()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 171, in run
        self.run_tests()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 253, in run_tests
        self.skipped, self.import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 425, in run_layer
        import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 345, in run_tests
        test(result)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 653, in __call__
        return self.run(*args, **kwds)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
        testMethod()
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 2185, in runTest
        test, out=new.write, clear_globs=False)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1467, in run
        return self.__run(test, compileflags, out)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.commit_from_wrong_partition[16]>", line 1, in <module>
        transaction.commit() # doctest: +ELLIPSIS
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 280, in commit
        t, v, tb = self._saveAndGetCommitishError()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
        rm.commit(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
        self._commit(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
        self._store_objects(ObjectWriter(obj), transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 565, in _store_objects
        '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 171, in storeBlob
        oid, serial, data, blobfilename, '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 713, in storeBlob
        self._blob_storeblob(oid, self._tid, blobfilename)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 748, in __getattr__
        return getattr(self.__storage, name)
    AttributeError: 'FileStorage' object has no attribute '_tid'

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 406, in ZODB.tests.testblob.commit_from_wrong_partition
Failed example:
    _ = transaction.savepoint() # doctest: +ELLIPSIS
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.commit_from_wrong_partition[20]>", line 1, in <module>
        _ = transaction.savepoint() # doctest: +ELLIPSIS
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 272, in savepoint
        return self.manager.savepoint(optimistic)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 151, in savepoint
        return self.get().savepoint(optimistic)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 221, in savepoint
        self._prior_operation_failed() # doesn't return, it raises
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 178, in _prior_operation_failed
        self._failure_traceback.getvalue())
    transaction.interfaces.TransactionFailedError: An operation previously failed, with traceback:

      File "/home/travis/virtualenv/python3.5.6/bin/zope-testrunner", line 11, in <module>
        sys.exit(run())
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 27, in run
        failed = run_internal(defaults, args, script_parts=script_parts, cwd=cwd)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 44, in run_internal
        runner.run()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 171, in run
        self.run_tests()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 253, in run_tests
        self.skipped, self.import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 425, in run_layer
        import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 345, in run_tests
        test(result)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 653, in __call__
        return self.run(*args, **kwds)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
        testMethod()
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 2185, in runTest
        test, out=new.write, clear_globs=False)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1467, in run
        return self.__run(test, compileflags, out)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.commit_from_wrong_partition[16]>", line 1, in <module>
        transaction.commit() # doctest: +ELLIPSIS
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 280, in commit
        t, v, tb = self._saveAndGetCommitishError()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
        rm.commit(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
        self._commit(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
        self._store_objects(ObjectWriter(obj), transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 565, in _store_objects
        '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 171, in storeBlob
        oid, serial, data, blobfilename, '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 713, in storeBlob
        self._blob_storeblob(oid, self._tid, blobfilename)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 748, in __getattr__
        return getattr(self.__storage, name)
    AttributeError: 'FileStorage' object has no attribute '_tid'

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 409, in ZODB.tests.testblob.commit_from_wrong_partition
Failed example:
    transaction.commit() # doctest: +ELLIPSIS
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.commit_from_wrong_partition[21]>", line 1, in <module>
        transaction.commit() # doctest: +ELLIPSIS
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 265, in commit
        self._prior_operation_failed() # doesn't return
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 178, in _prior_operation_failed
        self._failure_traceback.getvalue())
    transaction.interfaces.TransactionFailedError: An operation previously failed, with traceback:

      File "/home/travis/virtualenv/python3.5.6/bin/zope-testrunner", line 11, in <module>
        sys.exit(run())
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 27, in run
        failed = run_internal(defaults, args, script_parts=script_parts, cwd=cwd)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 44, in run_internal
        runner.run()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 171, in run
        self.run_tests()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 253, in run_tests
        self.skipped, self.import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 425, in run_layer
        import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 345, in run_tests
        test(result)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 653, in __call__
        return self.run(*args, **kwds)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
        testMethod()
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 2185, in runTest
        test, out=new.write, clear_globs=False)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1467, in run
        return self.__run(test, compileflags, out)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.commit_from_wrong_partition[16]>", line 1, in <module>
        transaction.commit() # doctest: +ELLIPSIS
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 280, in commit
        t, v, tb = self._saveAndGetCommitishError()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
        rm.commit(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
        self._commit(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
        self._store_objects(ObjectWriter(obj), transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 565, in _store_objects
        '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 171, in storeBlob
        oid, serial, data, blobfilename, '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 713, in storeBlob
        self._blob_storeblob(oid, self._tid, blobfilename)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 748, in __getattr__
        return getattr(self.__storage, name)
    AttributeError: 'FileStorage' object has no attribute '_tid'




Failure in test do_not_depend_on_cwd (ZODB.tests.testblob)
Failed doctest test for ZODB.tests.testblob.do_not_depend_on_cwd
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 600, in do_not_depend_on_cwd

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 611, in ZODB.tests.testblob.do_not_depend_on_cwd
Failed example:
    transaction.commit()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.do_not_depend_on_cwd[8]>", line 1, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
        rm.commit(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
        self._commit(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
        self._store_objects(ObjectWriter(obj), transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 565, in _store_objects
        '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 171, in storeBlob
        oid, serial, data, blobfilename, '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 713, in storeBlob
        self._blob_storeblob(oid, self._tid, blobfilename)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 748, in __getattr__
        return getattr(self.__storage, name)
    AttributeError: 'FileStorage' object has no attribute '_tid'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 613, in ZODB.tests.testblob.do_not_depend_on_cwd
Failed example:
    with conn.root()['blob'].open() as fp: fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.do_not_depend_on_cwd[10]>", line 1, in <module>
        with conn.root()['blob'].open() as fp: fp.read()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 989, in __getitem__
        raise KeyError(key)
    KeyError: 'blob'



Failure in test is_blob_record (ZODB.tests.testblob)
Failed doctest test for ZODB.tests.testblob.is_blob_record
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 569, in is_blob_record

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 577, in ZODB.tests.testblob.is_blob_record
Failed example:
    transaction.commit()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.is_blob_record[5]>", line 1, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
        rm.commit(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
        self._commit(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
        self._store_objects(ObjectWriter(obj), transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 565, in _store_objects
        '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 171, in storeBlob
        oid, serial, data, blobfilename, '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 713, in storeBlob
        self._blob_storeblob(oid, self._tid, blobfilename)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 748, in __getattr__
        return getattr(self.__storage, name)
    AttributeError: 'FileStorage' object has no attribute '_tid'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 580, in ZODB.tests.testblob.is_blob_record
Failed example:
    ZODB.blob.is_blob_record(load_current(bs, ZODB.utils.p64(1))[0])
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.is_blob_record[7]>", line 1, in <module>
        ZODB.blob.is_blob_record(load_current(bs, ZODB.utils.p64(1))[0])
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/utils.py", line 398, in load_current
        r = storage.loadBefore(oid, maxtid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 476, in loadBefore
        pos = self._lookup_pos(oid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 435, in _lookup_pos
        raise POSKeyError(oid)
    ZODB.POSException.POSKeyError: 0x01



Failure in test loadblob_tmpstore (ZODB.tests.testblob)
Failed doctest test for ZODB.tests.testblob.loadblob_tmpstore
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 530, in loadblob_tmpstore

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 547, in ZODB.tests.testblob.loadblob_tmpstore
Failed example:
    transaction.commit()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.loadblob_tmpstore[9]>", line 1, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
        rm.commit(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
        self._commit(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
        self._store_objects(ObjectWriter(obj), transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 565, in _store_objects
        '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 171, in storeBlob
        oid, serial, data, blobfilename, '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 713, in storeBlob
        self._blob_storeblob(oid, self._tid, blobfilename)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 748, in __getattr__
        return getattr(self.__storage, name)
    AttributeError: 'FileStorage' object has no attribute '_tid'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 548, in ZODB.tests.testblob.loadblob_tmpstore
Failed example:
    blob_oid = root['blob']._p_oid
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.loadblob_tmpstore[10]>", line 1, in <module>
        blob_oid = root['blob']._p_oid
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 989, in __getitem__
        raise KeyError(key)
    KeyError: 'blob'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 560, in ZODB.tests.testblob.loadblob_tmpstore
Failed example:
    tmpstore.loadBlob(blob_oid,tid) == blob_storage.loadBlob(blob_oid,tid)
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.loadblob_tmpstore[15]>", line 1, in <module>
        tmpstore.loadBlob(blob_oid,tid) == blob_storage.loadBlob(blob_oid,tid)
    NameError: name 'blob_oid' is not defined



Failure in test savepoint_cleanup (ZODB.tests.testblob)
Failed doctest test for ZODB.tests.testblob.savepoint_cleanup
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 679, in savepoint_cleanup

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 697, in ZODB.tests.testblob.savepoint_cleanup
Failed example:
    transaction.commit()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.savepoint_cleanup[11]>", line 1, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
        rm.commit(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
        self._commit(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
        self._store_objects(ObjectWriter(obj), transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 565, in _store_objects
        '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 171, in storeBlob
        oid, serial, data, blobfilename, '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 713, in storeBlob
        self._blob_storeblob(oid, self._tid, blobfilename)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 748, in __getattr__
        return getattr(self.__storage, name)
    AttributeError: 'FileStorage' object has no attribute '_tid'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 698, in ZODB.tests.testblob.savepoint_cleanup
Failed example:
    with conn.root.b.open('w') as file:
        _ = file.write(b'1')
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.savepoint_cleanup[12]>", line 1, in <module>
        with conn.root.b.open('w') as file:
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 1219, in __getattr__
        raise AttributeError(name)
    AttributeError: b
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 700, in ZODB.tests.testblob.savepoint_cleanup
Failed example:
    _ = transaction.savepoint()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.savepoint_cleanup[13]>", line 1, in <module>
        _ = transaction.savepoint()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 272, in savepoint
        return self.manager.savepoint(optimistic)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 151, in savepoint
        return self.get().savepoint(optimistic)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 221, in savepoint
        self._prior_operation_failed() # doesn't return, it raises
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 178, in _prior_operation_failed
        self._failure_traceback.getvalue())
    transaction.interfaces.TransactionFailedError: An operation previously failed, with traceback:

      File "/home/travis/virtualenv/python3.5.6/bin/zope-testrunner", line 11, in <module>
        sys.exit(run())
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 27, in run
        failed = run_internal(defaults, args, script_parts=script_parts, cwd=cwd)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 44, in run_internal
        runner.run()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 171, in run
        self.run_tests()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 253, in run_tests
        self.skipped, self.import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 425, in run_layer
        import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 345, in run_tests
        test(result)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 653, in __call__
        return self.run(*args, **kwds)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
        testMethod()
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 2185, in runTest
        test, out=new.write, clear_globs=False)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1467, in run
        return self.__run(test, compileflags, out)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.savepoint_cleanup[11]>", line 1, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 280, in commit
        t, v, tb = self._saveAndGetCommitishError()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
        rm.commit(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
        self._commit(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
        self._store_objects(ObjectWriter(obj), transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 565, in _store_objects
        '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 171, in storeBlob
        oid, serial, data, blobfilename, '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 713, in storeBlob
        self._blob_storeblob(oid, self._tid, blobfilename)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 748, in __getattr__
        return getattr(self.__storage, name)
    AttributeError: 'FileStorage' object has no attribute '_tid'




Failure in test savepoint_commits_without_invalidations_out_of_order (ZODB.tests.testblob)
Failed doctest test for ZODB.tests.testblob.savepoint_commits_without_invalidations_out_of_order
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 647, in savepoint_commits_without_invalidations_out_of_order

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 656, in ZODB.tests.testblob.savepoint_commits_without_invalidations_out_of_order
Failed example:
    tm1.commit()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.savepoint_commits_without_invalidations_out_of_order[5]>", line 1, in <module>
        tm1.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
        rm.commit(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
        self._commit(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
        self._store_objects(ObjectWriter(obj), transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 565, in _store_objects
        '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 171, in storeBlob
        oid, serial, data, blobfilename, '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 713, in storeBlob
        self._blob_storeblob(oid, self._tid, blobfilename)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 748, in __getattr__
        return getattr(self.__storage, name)
    AttributeError: 'FileStorage' object has no attribute '_tid'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 657, in ZODB.tests.testblob.savepoint_commits_without_invalidations_out_of_order
Failed example:
    with conn1.root.b.open('w') as file:
        _ = file.write(b'1')
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.savepoint_commits_without_invalidations_out_of_order[6]>", line 1, in <module>
        with conn1.root.b.open('w') as file:
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 1219, in __getattr__
        raise AttributeError(name)
    AttributeError: b
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 659, in ZODB.tests.testblob.savepoint_commits_without_invalidations_out_of_order
Failed example:
    _ = tm1.savepoint()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.savepoint_commits_without_invalidations_out_of_order[7]>", line 1, in <module>
        _ = tm1.savepoint()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 151, in savepoint
        return self.get().savepoint(optimistic)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 221, in savepoint
        self._prior_operation_failed() # doesn't return, it raises
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 178, in _prior_operation_failed
        self._failure_traceback.getvalue())
    transaction.interfaces.TransactionFailedError: An operation previously failed, with traceback:

      File "/home/travis/virtualenv/python3.5.6/bin/zope-testrunner", line 11, in <module>
        sys.exit(run())
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 27, in run
        failed = run_internal(defaults, args, script_parts=script_parts, cwd=cwd)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 44, in run_internal
        runner.run()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 171, in run
        self.run_tests()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 253, in run_tests
        self.skipped, self.import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 425, in run_layer
        import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 345, in run_tests
        test(result)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 653, in __call__
        return self.run(*args, **kwds)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
        testMethod()
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 2185, in runTest
        test, out=new.write, clear_globs=False)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1467, in run
        return self.__run(test, compileflags, out)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.savepoint_commits_without_invalidations_out_of_order[5]>", line 1, in <module>
        tm1.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 280, in commit
        t, v, tb = self._saveAndGetCommitishError()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
        rm.commit(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
        self._commit(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
        self._store_objects(ObjectWriter(obj), transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 565, in _store_objects
        '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 171, in storeBlob
        oid, serial, data, blobfilename, '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 713, in storeBlob
        self._blob_storeblob(oid, self._tid, blobfilename)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 748, in __getattr__
        return getattr(self.__storage, name)
    AttributeError: 'FileStorage' object has no attribute '_tid'

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 663, in ZODB.tests.testblob.savepoint_commits_without_invalidations_out_of_order
Failed example:
    with conn2.root.b.open('w') as file:
        _ = file.write(b'2')
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.savepoint_commits_without_invalidations_out_of_order[10]>", line 1, in <module>
        with conn2.root.b.open('w') as file:
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 1219, in __getattr__
        raise AttributeError(name)
    AttributeError: b
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 665, in ZODB.tests.testblob.savepoint_commits_without_invalidations_out_of_order
Failed example:
    _ = tm1.savepoint()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.savepoint_commits_without_invalidations_out_of_order[11]>", line 1, in <module>
        _ = tm1.savepoint()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 151, in savepoint
        return self.get().savepoint(optimistic)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 221, in savepoint
        self._prior_operation_failed() # doesn't return, it raises
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 178, in _prior_operation_failed
        self._failure_traceback.getvalue())
    transaction.interfaces.TransactionFailedError: An operation previously failed, with traceback:

      File "/home/travis/virtualenv/python3.5.6/bin/zope-testrunner", line 11, in <module>
        sys.exit(run())
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 27, in run
        failed = run_internal(defaults, args, script_parts=script_parts, cwd=cwd)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 44, in run_internal
        runner.run()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 171, in run
        self.run_tests()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 253, in run_tests
        self.skipped, self.import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 425, in run_layer
        import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 345, in run_tests
        test(result)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 653, in __call__
        return self.run(*args, **kwds)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
        testMethod()
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 2185, in runTest
        test, out=new.write, clear_globs=False)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1467, in run
        return self.__run(test, compileflags, out)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.savepoint_commits_without_invalidations_out_of_order[5]>", line 1, in <module>
        tm1.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 280, in commit
        t, v, tb = self._saveAndGetCommitishError()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
        rm.commit(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
        self._commit(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
        self._store_objects(ObjectWriter(obj), transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 565, in _store_objects
        '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 171, in storeBlob
        oid, serial, data, blobfilename, '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 713, in storeBlob
        self._blob_storeblob(oid, self._tid, blobfilename)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 748, in __getattr__
        return getattr(self.__storage, name)
    AttributeError: 'FileStorage' object has no attribute '_tid'

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 666, in ZODB.tests.testblob.savepoint_commits_without_invalidations_out_of_order
Failed example:
    with conn1.root.b.open() as fp: fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.savepoint_commits_without_invalidations_out_of_order[12]>", line 1, in <module>
        with conn1.root.b.open() as fp: fp.read()
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 1219, in __getattr__
        raise AttributeError(name)
    AttributeError: b
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 668, in ZODB.tests.testblob.savepoint_commits_without_invalidations_out_of_order
Failed example:
    with conn2.root.b.open() as fp: fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.savepoint_commits_without_invalidations_out_of_order[13]>", line 1, in <module>
        with conn2.root.b.open() as fp: fp.read()
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 1219, in __getattr__
        raise AttributeError(name)
    AttributeError: b
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 671, in ZODB.tests.testblob.savepoint_commits_without_invalidations_out_of_order
Failed example:
    tm1.commit()  # doctest: +IGNORE_EXCEPTION_DETAIL
Expected:
    Traceback (most recent call last):
        ...
    ConflictError: database conflict error...
Got:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.savepoint_commits_without_invalidations_out_of_order[15]>", line 1, in <module>
        tm1.commit()  # doctest: +IGNORE_EXCEPTION_DETAIL
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 265, in commit
        self._prior_operation_failed() # doesn't return
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 178, in _prior_operation_failed
        self._failure_traceback.getvalue())
    transaction.interfaces.TransactionFailedError: An operation previously failed, with traceback:
    <BLANKLINE>
      File "/home/travis/virtualenv/python3.5.6/bin/zope-testrunner", line 11, in <module>
        sys.exit(run())
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 27, in run
        failed = run_internal(defaults, args, script_parts=script_parts, cwd=cwd)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 44, in run_internal
        runner.run()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 171, in run
        self.run_tests()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 253, in run_tests
        self.skipped, self.import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 425, in run_layer
        import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 345, in run_tests
        test(result)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 653, in __call__
        return self.run(*args, **kwds)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
        testMethod()
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 2185, in runTest
        test, out=new.write, clear_globs=False)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1467, in run
        return self.__run(test, compileflags, out)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.savepoint_commits_without_invalidations_out_of_order[5]>", line 1, in <module>
        tm1.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 280, in commit
        t, v, tb = self._saveAndGetCommitishError()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
        rm.commit(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
        self._commit(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
        self._store_objects(ObjectWriter(obj), transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 565, in _store_objects
        '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 171, in storeBlob
        oid, serial, data, blobfilename, '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 713, in storeBlob
        self._blob_storeblob(oid, self._tid, blobfilename)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 748, in __getattr__
        return getattr(self.__storage, name)
    AttributeError: 'FileStorage' object has no attribute '_tid'
    <BLANKLINE>



Failure in test savepoint_isolation (ZODB.tests.testblob)
Failed doctest test for ZODB.tests.testblob.savepoint_isolation
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 619, in savepoint_isolation

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 626, in ZODB.tests.testblob.savepoint_isolation
Failed example:
    transaction.commit()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.savepoint_isolation[4]>", line 1, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
        rm.commit(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
        self._commit(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
        self._store_objects(ObjectWriter(obj), transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 565, in _store_objects
        '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 171, in storeBlob
        oid, serial, data, blobfilename, '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 713, in storeBlob
        self._blob_storeblob(oid, self._tid, blobfilename)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 748, in __getattr__
        return getattr(self.__storage, name)
    AttributeError: 'FileStorage' object has no attribute '_tid'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 627, in ZODB.tests.testblob.savepoint_isolation
Failed example:
    with conn.root.b.open('w') as file:
        _ = file.write(b'1')
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.savepoint_isolation[5]>", line 1, in <module>
        with conn.root.b.open('w') as file:
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 1219, in __getattr__
        raise AttributeError(name)
    AttributeError: b
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 629, in ZODB.tests.testblob.savepoint_isolation
Failed example:
    _ = transaction.savepoint()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.savepoint_isolation[6]>", line 1, in <module>
        _ = transaction.savepoint()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 272, in savepoint
        return self.manager.savepoint(optimistic)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 151, in savepoint
        return self.get().savepoint(optimistic)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 221, in savepoint
        self._prior_operation_failed() # doesn't return, it raises
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 178, in _prior_operation_failed
        self._failure_traceback.getvalue())
    transaction.interfaces.TransactionFailedError: An operation previously failed, with traceback:

      File "/home/travis/virtualenv/python3.5.6/bin/zope-testrunner", line 11, in <module>
        sys.exit(run())
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 27, in run
        failed = run_internal(defaults, args, script_parts=script_parts, cwd=cwd)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 44, in run_internal
        runner.run()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 171, in run
        self.run_tests()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 253, in run_tests
        self.skipped, self.import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 425, in run_layer
        import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 345, in run_tests
        test(result)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 653, in __call__
        return self.run(*args, **kwds)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
        testMethod()
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 2185, in runTest
        test, out=new.write, clear_globs=False)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1467, in run
        return self.__run(test, compileflags, out)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.savepoint_isolation[4]>", line 1, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 280, in commit
        t, v, tb = self._saveAndGetCommitishError()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
        rm.commit(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
        self._commit(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
        self._store_objects(ObjectWriter(obj), transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 565, in _store_objects
        '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 171, in storeBlob
        oid, serial, data, blobfilename, '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 713, in storeBlob
        self._blob_storeblob(oid, self._tid, blobfilename)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 748, in __getattr__
        return getattr(self.__storage, name)
    AttributeError: 'FileStorage' object has no attribute '_tid'

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 632, in ZODB.tests.testblob.savepoint_isolation
Failed example:
    with conn2.root.b.open('w') as file:
        _ = file.write(b'2')
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.savepoint_isolation[9]>", line 1, in <module>
        with conn2.root.b.open('w') as file:
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 1219, in __getattr__
        raise AttributeError(name)
    AttributeError: b
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 635, in ZODB.tests.testblob.savepoint_isolation
Failed example:
    with conn.root.b.open() as fp: fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.savepoint_isolation[11]>", line 1, in <module>
        with conn.root.b.open() as fp: fp.read()
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 1219, in __getattr__
        raise AttributeError(name)
    AttributeError: b
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 637, in ZODB.tests.testblob.savepoint_isolation
Failed example:
    with conn2.root.b.open() as fp: fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.savepoint_isolation[12]>", line 1, in <module>
        with conn2.root.b.open() as fp: fp.read()
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 1219, in __getattr__
        raise AttributeError(name)
    AttributeError: b
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 642, in ZODB.tests.testblob.savepoint_isolation
Failed example:
    with conn.root.b.open() as fp: fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.savepoint_isolation[16]>", line 1, in <module>
        with conn.root.b.open() as fp: fp.read()
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 1219, in __getattr__
        raise AttributeError(name)
    AttributeError: b



Error in test testSimpleBlobRecovery (ZODB.tests.testblob.BlobAdaptedFileStorageRecoveryBlobStorage)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 320, in testSimpleBlobRecovery
    transaction.commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
    return self.manager.commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
    return self.get().commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
    self._commitResources()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
    rm.commit(self)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
    self._commit(transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
    self._store_objects(ObjectWriter(obj), transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 565, in _store_objects
    '', transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 171, in storeBlob
    oid, serial, data, blobfilename, '', transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 713, in storeBlob
    self._blob_storeblob(oid, self._tid, blobfilename)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 748, in __getattr__
    return getattr(self.__storage, name)
AttributeError: 'FileStorage' object has no attribute '_tid'



Error in test testRedo (ZODB.tests.testblob.BlobAdaptedFileStorageBlobUndoTests)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 253, in testRedo
    transaction.commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
    return self.manager.commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
    return self.get().commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
    self._commitResources()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
    rm.commit(self)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
    self._commit(transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
    self._store_objects(ObjectWriter(obj), transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 565, in _store_objects
    '', transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 171, in storeBlob
    oid, serial, data, blobfilename, '', transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 713, in storeBlob
    self._blob_storeblob(oid, self._tid, blobfilename)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 748, in __getattr__
    return getattr(self.__storage, name)
AttributeError: 'FileStorage' object has no attribute '_tid'



Error in test testRedoOfCreation (ZODB.tests.testblob.BlobAdaptedFileStorageBlobUndoTests)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 285, in testRedoOfCreation
    transaction.commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
    return self.manager.commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
    return self.get().commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
    self._commitResources()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
    rm.commit(self)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
    self._commit(transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
    self._store_objects(ObjectWriter(obj), transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 565, in _store_objects
    '', transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 171, in storeBlob
    oid, serial, data, blobfilename, '', transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 713, in storeBlob
    self._blob_storeblob(oid, self._tid, blobfilename)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 748, in __getattr__
    return getattr(self.__storage, name)
AttributeError: 'FileStorage' object has no attribute '_tid'



Error in test testUndo (ZODB.tests.testblob.BlobAdaptedFileStorageBlobUndoTests)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 200, in testUndo
    transaction.commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
    return self.manager.commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
    return self.get().commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
    self._commitResources()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
    rm.commit(self)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
    self._commit(transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
    self._store_objects(ObjectWriter(obj), transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 565, in _store_objects
    '', transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 171, in storeBlob
    oid, serial, data, blobfilename, '', transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 713, in storeBlob
    self._blob_storeblob(oid, self._tid, blobfilename)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 748, in __getattr__
    return getattr(self.__storage, name)
AttributeError: 'FileStorage' object has no attribute '_tid'



Error in test testUndoAfterConsumption (ZODB.tests.testblob.BlobAdaptedFileStorageBlobUndoTests)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 226, in testUndoAfterConsumption
    transaction.commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
    return self.manager.commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
    return self.get().commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
    self._commitResources()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
    rm.commit(self)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
    self._commit(transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
    self._store_objects(ObjectWriter(obj), transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 565, in _store_objects
    '', transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 171, in storeBlob
    oid, serial, data, blobfilename, '', transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 713, in storeBlob
    self._blob_storeblob(oid, self._tid, blobfilename)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 748, in __getattr__
    return getattr(self.__storage, name)
AttributeError: 'FileStorage' object has no attribute '_tid'



Error in test testUndoWithoutPreviousVersion (ZODB.tests.testblob.BlobAdaptedFileStorageBlobUndoTests)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 182, in testUndoWithoutPreviousVersion
    transaction.commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
    return self.manager.commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
    return self.get().commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
    self._commitResources()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
    rm.commit(self)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
    self._commit(transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
    self._store_objects(ObjectWriter(obj), transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 565, in _store_objects
    '', transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 171, in storeBlob
    oid, serial, data, blobfilename, '', transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 713, in storeBlob
    self._blob_storeblob(oid, self._tid, blobfilename)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 748, in __getattr__
    return getattr(self.__storage, name)
AttributeError: 'FileStorage' object has no attribute '_tid'

  Ran 22 tests with 11 failures, 7 errors and 0 skipped in 5.595 seconds.
Running .BlobFileHexStorageBlobTests tests:
  Tear down .BlobAdaptedFileStorageBlobTests in 0.000 seconds.
  Set up .BlobFileHexStorageBlobTests in 0.000 seconds.


Failure in test /home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_importexport.txt
Failed doctest test for blob_importexport.txt
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_importexport.txt", line 0

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_importexport.txt", line 49, in blob_importexport.txt
Failed example:
    transaction.commit()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_importexport.txt[26]>", line 1, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 447, in _commitResources
        rm.tpc_finish(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 672, in tpc_finish
        serial = self._storage.tpc_finish(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 182, in tpc_finish
        return self._storage.tpc_finish(transaction, invalidate_finish)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 707, in tpc_finish
        self._finish(tbuf, tid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 722, in _finish
        self._pos, tindex = tbuf.commit(tid, self._file, pos)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 2210, in commit
        rename_or_copy_blob(blobfilename, targetname)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 906, in rename_or_copy_blob
        with open(f1, 'rb') as file1:
    FileNotFoundError: [Errno 2] No such file or directory: '2.bobs/tmp/savepoints2yek9mi6/0x02-0x00.spb'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_importexport.txt", line 55, in blob_importexport.txt
Failed example:
    bool(items1.keys() == items2.keys())
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_importexport.txt[29]>", line 1, in <module>
        bool(items1.keys() == items2.keys())
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 753, in setstate
        p, serial = self._storage.load(oid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 144, in load
        r = self._storage.loadBefore(oid, self._start)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/hexstorage.py", line 52, in loadBefore
        r = self.base.loadBefore(oid, tid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 476, in loadBefore
        pos = self._lookup_pos(oid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 435, in _lookup_pos
        raise POSKeyError(oid)
    ZODB.POSException.POSKeyError: 0x01
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_importexport.txt", line 57, in blob_importexport.txt
Failed example:
    with items1['blob1'].open() as fp1:
        with items2['blob1'].open() as fp2:
            fp1.read() == fp2.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_importexport.txt[30]>", line 2, in <module>
        with items2['blob1'].open() as fp2:
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 985, in __getitem__
        if key in self.data:
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 753, in setstate
        p, serial = self._storage.load(oid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 144, in load
        r = self._storage.loadBefore(oid, self._start)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/hexstorage.py", line 52, in loadBefore
        r = self.base.loadBefore(oid, tid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 476, in loadBefore
        pos = self._lookup_pos(oid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 435, in _lookup_pos
        raise POSKeyError(oid)
    ZODB.POSException.POSKeyError: 0x01
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_importexport.txt", line 61, in blob_importexport.txt
Failed example:
    with items1['blob2'].open() as fp1:
        with items2['blob2'].open() as fp2:
            fp1.read() == fp2.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_importexport.txt[31]>", line 2, in <module>
        with items2['blob2'].open() as fp2:
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 985, in __getitem__
        if key in self.data:
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 753, in setstate
        p, serial = self._storage.load(oid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 144, in load
        r = self._storage.loadBefore(oid, self._start)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/hexstorage.py", line 52, in loadBefore
        r = self.base.loadBefore(oid, tid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 476, in loadBefore
        pos = self._lookup_pos(oid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 435, in _lookup_pos
        raise POSKeyError(oid)
    ZODB.POSException.POSKeyError: 0x01



Failure in test /home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt
Failed doctest test for blob_transaction.txt
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 0

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 246, in blob_transaction.txt
Failed example:
    transaction.commit()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[90]>", line 1, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 447, in _commitResources
        rm.tpc_finish(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 672, in tpc_finish
        serial = self._storage.tpc_finish(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 182, in tpc_finish
        return self._storage.tpc_finish(transaction, invalidate_finish)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 707, in tpc_finish
        self._finish(tbuf, tid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 722, in _finish
        self._pos, tindex = tbuf.commit(tid, self._file, pos)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 2210, in commit
        rename_or_copy_blob(blobfilename, targetname)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 906, in rename_or_copy_blob
        with open(f1, 'rb') as file1:
    FileNotFoundError: [Errno 2] No such file or directory: 'blobs/tmp/savepoints2k90rmlb/0x03-0x03d86d067c433111.spb'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 255, in blob_transaction.txt
Failed example:
    with root5['blob'].open("r") as fp:
        fp.read()
Expected:
    "I'm a happy blob. And I'm singing. And I'm dancing."
Got:
    "I'm a happy blob. And I'm dancing."
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 258, in blob_transaction.txt
Failed example:
    savepoint = transaction.savepoint()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[94]>", line 1, in <module>
        savepoint = transaction.savepoint()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 272, in savepoint
        return self.manager.savepoint(optimistic)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 151, in savepoint
        return self.get().savepoint(optimistic)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 221, in savepoint
        self._prior_operation_failed() # doesn't return, it raises
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 178, in _prior_operation_failed
        self._failure_traceback.getvalue())
    transaction.interfaces.TransactionFailedError: An operation previously failed, with traceback:

      File "/home/travis/virtualenv/python3.5.6/bin/zope-testrunner", line 11, in <module>
        sys.exit(run())
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 27, in run
        failed = run_internal(defaults, args, script_parts=script_parts, cwd=cwd)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 44, in run_internal
        runner.run()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 171, in run
        self.run_tests()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 253, in run_tests
        self.skipped, self.import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 425, in run_layer
        import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 345, in run_tests
        test(result)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 653, in __call__
        return self.run(*args, **kwds)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
        testMethod()
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 2185, in runTest
        test, out=new.write, clear_globs=False)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1467, in run
        return self.__run(test, compileflags, out)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[90]>", line 1, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 280, in commit
        t, v, tb = self._saveAndGetCommitishError()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 447, in _commitResources
        rm.tpc_finish(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 672, in tpc_finish
        serial = self._storage.tpc_finish(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 182, in tpc_finish
        return self._storage.tpc_finish(transaction, invalidate_finish)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 707, in tpc_finish
        self._finish(tbuf, tid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 722, in _finish
        self._pos, tindex = tbuf.commit(tid, self._file, pos)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 2210, in commit
        rename_or_copy_blob(blobfilename, targetname)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 906, in rename_or_copy_blob
        with open(f1, 'rb') as file1:
    FileNotFoundError: [Errno 2] No such file or directory: 'blobs/tmp/savepoints2k90rmlb/0x03-0x03d86d067c433111.spb'

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 262, in blob_transaction.txt
Failed example:
    len([name for name in os.listdir(os.path.join(blob_dir, 'tmp'))
         if name.startswith('savepoint')])
Expected:
    1
Got:
    0
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 268, in blob_transaction.txt
Failed example:
    savepoint.rollback()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[97]>", line 1, in <module>
        savepoint.rollback()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 651, in rollback
        'invalidated by a later savepoint')
    transaction.interfaces.InvalidSavepointRollbackError: invalidated by a later savepoint
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 270, in blob_transaction.txt
Failed example:
    with root5['blob'].open("r") as fp:
        fp.read()
Expected:
    "I'm a happy blob. And I'm singing. And I'm dancing."
Got:
    ' And the weather is beautiful.'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 294, in blob_transaction.txt
Failed example:
    transaction.commit()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[106]>", line 1, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
        rm.commit(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
        self._commit(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
        self._store_objects(ObjectWriter(obj), transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 572, in _store_objects
        s = self._storage.store(oid, serial, p, '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 166, in store
        self._storage.store(oid, serial, data, version, transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/hexstorage.py", line 76, in store
        oid, serial, b'.h'+hexlify(data), version, transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 512, in store
        h = self._read_data_header(old, oid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/format.py", line 147, in _read_data_header
        _file.seek(pos)
    ValueError: seek of closed file
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 295, in blob_transaction.txt
Failed example:
    with open(blob.committed()) as fp:
        fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[107]>", line 1, in <module>
        with open(blob.committed()) as fp:
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 221, in committed
        raise BlobError('Uncommitted changes')
    ZODB.interfaces.BlobError: Uncommitted changes
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 301, in blob_transaction.txt
Failed example:
    f = blob.open('c')
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[108]>", line 1, in <module>
        f = blob.open('c')
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 147, in open
        raise BlobError('Uncommitted changes')
    ZODB.interfaces.BlobError: Uncommitted changes
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 305, in blob_transaction.txt
Failed example:
    type(f) == file_type
Expected:
    True
Got:
    False
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 310, in blob_transaction.txt
Failed example:
    with blob.open('w') as file:
        _ = file.write(b'x')
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[110]>", line 1, in <module>
        with blob.open('w') as file:
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 210, in open
        self._p_changed = True
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 792, in register
        self._register(obj)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 802, in _register
        self.transaction_manager.get().join(self)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 184, in join
        self._prior_operation_failed() # doesn't return
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 178, in _prior_operation_failed
        self._failure_traceback.getvalue())
    transaction.interfaces.TransactionFailedError: An operation previously failed, with traceback:

      File "/home/travis/virtualenv/python3.5.6/bin/zope-testrunner", line 11, in <module>
        sys.exit(run())
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 27, in run
        failed = run_internal(defaults, args, script_parts=script_parts, cwd=cwd)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 44, in run_internal
        runner.run()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 171, in run
        self.run_tests()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 253, in run_tests
        self.skipped, self.import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 425, in run_layer
        import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 345, in run_tests
        test(result)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 653, in __call__
        return self.run(*args, **kwds)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
        testMethod()
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 2185, in runTest
        test, out=new.write, clear_globs=False)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1467, in run
        return self.__run(test, compileflags, out)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[106]>", line 1, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 280, in commit
        t, v, tb = self._saveAndGetCommitishError()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
        rm.commit(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
        self._commit(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
        self._store_objects(ObjectWriter(obj), transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 572, in _store_objects
        s = self._storage.store(oid, serial, p, '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 166, in store
        self._storage.store(oid, serial, data, version, transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/hexstorage.py", line 76, in store
        oid, serial, b'.h'+hexlify(data), version, transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 512, in store
        h = self._read_data_header(old, oid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/format.py", line 147, in _read_data_header
        _file.seek(pos)
    ValueError: seek of closed file

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 312, in blob_transaction.txt
Failed example:
    with blob.open() as fp: fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[111]>", line 1, in <module>
        with blob.open() as fp: fp.read()
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 152, in open
        raise BlobError("Already opened for writing.")
    ZODB.interfaces.BlobError: Already opened for writing.
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 315, in blob_transaction.txt
Failed example:
    f.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[112]>", line 1, in <module>
        f.read()
    ValueError: I/O operation on closed file
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 359, in blob_transaction.txt
Failed example:
    transaction.commit()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[125]>", line 1, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
        rm.commit(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 462, in commit
        self._commit_savepoint(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 1011, in _commit_savepoint
        self._storage.store(oid, serial, data, '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 166, in store
        self._storage.store(oid, serial, data, version, transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/hexstorage.py", line 76, in store
        oid, serial, b'.h'+hexlify(data), version, transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 512, in store
        h = self._read_data_header(old, oid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/format.py", line 147, in _read_data_header
        _file.seek(pos)
    ValueError: seek of closed file
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 360, in blob_transaction.txt
Failed example:
    with open(blob.committed()) as fp:
        fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[126]>", line 1, in <module>
        with open(blob.committed()) as fp:
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 221, in committed
        raise BlobError('Uncommitted changes')
    ZODB.interfaces.BlobError: Uncommitted changes
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 379, in blob_transaction.txt
Failed example:
    olddata, oldserial = blob_storage.load(blob._p_oid, '')
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[128]>", line 1, in <module>
        olddata, oldserial = blob_storage.load(blob._p_oid, '')
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/utils.py", line 398, in load_current
        r = storage.loadBefore(oid, maxtid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/hexstorage.py", line 52, in loadBefore
        r = self.base.loadBefore(oid, tid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 476, in loadBefore
        pos = self._lookup_pos(oid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 433, in _lookup_pos
        return self._index[oid]
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/fsIndex.py", line 108, in __getitem__
        assert isinstance(key, bytes)
    AssertionError
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 384, in blob_transaction.txt
Failed example:
    blob_storage.storeBlob(blob._p_oid, oldserial, olddata, 'blobfile',
                                '', t)
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[132]>", line 1, in <module>
        blob_storage.storeBlob(blob._p_oid, oldserial, olddata, 'blobfile',
    NameError: name 'oldserial' is not defined
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 389, in blob_transaction.txt
Failed example:
    blob_storage.storeBlob(new_oid, '\0'*8, olddata, 'blobfile2',
                                '', t)
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[135]>", line 1, in <module>
        blob_storage.storeBlob(new_oid, '\0'*8, olddata, 'blobfile2',
    NameError: name 'olddata' is not defined
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 397, in blob_transaction.txt
Failed example:
    blob_storage.load(blob._p_oid, '') == (olddata, oldserial)
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[138]>", line 1, in <module>
        blob_storage.load(blob._p_oid, '') == (olddata, oldserial)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/utils.py", line 398, in load_current
        r = storage.loadBefore(oid, maxtid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/hexstorage.py", line 52, in loadBefore
        r = self.base.loadBefore(oid, tid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 476, in loadBefore
        pos = self._lookup_pos(oid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 433, in _lookup_pos
        return self._index[oid]
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/fsIndex.py", line 108, in __getitem__
        assert isinstance(key, bytes)
    AssertionError
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 402, in blob_transaction.txt
Failed example:
    with open(blob_storage.loadBlob(blob._p_oid, oldserial)) as fp:
        fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[139]>", line 1, in <module>
        with open(blob_storage.loadBlob(blob._p_oid, oldserial)) as fp:
    NameError: name 'oldserial' is not defined



Failure in test commit_from_wrong_partition (ZODB.tests.testblob)
Failed doctest test for ZODB.tests.testblob.commit_from_wrong_partition
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 367, in commit_from_wrong_partition

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 409, in ZODB.tests.testblob.commit_from_wrong_partition
Failed example:
    transaction.commit() # doctest: +ELLIPSIS
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.commit_from_wrong_partition[21]>", line 1, in <module>
        transaction.commit() # doctest: +ELLIPSIS
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 447, in _commitResources
        rm.tpc_finish(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 672, in tpc_finish
        serial = self._storage.tpc_finish(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 182, in tpc_finish
        return self._storage.tpc_finish(transaction, invalidate_finish)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 707, in tpc_finish
        self._finish(tbuf, tid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 722, in _finish
        self._pos, tindex = tbuf.commit(tid, self._file, pos)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 2210, in commit
        rename_or_copy_blob(blobfilename, targetname)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 906, in rename_or_copy_blob
        with open(f1, 'rb') as file1:
    FileNotFoundError: [Errno 2] No such file or directory: 'data.bobs/tmp/savepoints5bpfwimv/0x02-0x00.spb'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 412, in ZODB.tests.testblob.commit_from_wrong_partition
Failed example:
    with root['blob2'].open() as fp: fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.commit_from_wrong_partition[22]>", line 1, in <module>
        with root['blob2'].open() as fp: fp.read()
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 753, in setstate
        p, serial = self._storage.load(oid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 144, in load
        r = self._storage.loadBefore(oid, self._start)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/hexstorage.py", line 52, in loadBefore
        r = self.base.loadBefore(oid, tid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 476, in loadBefore
        pos = self._lookup_pos(oid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 435, in _lookup_pos
        raise POSKeyError(oid)
    ZODB.POSException.POSKeyError: 0x02



Failure in test savepoint_isolation (ZODB.tests.testblob)
Failed doctest test for ZODB.tests.testblob.savepoint_isolation
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 619, in savepoint_isolation

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 640, in ZODB.tests.testblob.savepoint_isolation
Failed example:
    tm.commit()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.savepoint_isolation[14]>", line 1, in <module>
        tm.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 447, in _commitResources
        rm.tpc_finish(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 672, in tpc_finish
        serial = self._storage.tpc_finish(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 182, in tpc_finish
        return self._storage.tpc_finish(transaction, invalidate_finish)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 707, in tpc_finish
        self._finish(tbuf, tid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 722, in _finish
        self._pos, tindex = tbuf.commit(tid, self._file, pos)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 2210, in commit
        rename_or_copy_blob(blobfilename, targetname)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 906, in rename_or_copy_blob
        with open(f1, 'rb') as file1:
    FileNotFoundError: [Errno 2] No such file or directory: 'data.bobs/tmp/savepointsbim2ohrx/0x01-0x03d86d06a471ae44.spb'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 642, in ZODB.tests.testblob.savepoint_isolation
Failed example:
    with conn.root.b.open() as fp: fp.read()
Expected:
    '2'
Got:
    'initial'

  Ran 22 tests with 15 failures, 1 errors and 0 skipped in 9.839 seconds.
Running .BlobFileStorageBlobTests tests:
  Tear down .BlobFileHexStorageBlobTests in 0.000 seconds.
  Set up .BlobFileStorageBlobTests in 0.000 seconds.


Failure in test /home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_importexport.txt
Failed doctest test for blob_importexport.txt
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_importexport.txt", line 0

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_importexport.txt", line 49, in blob_importexport.txt
Failed example:
    transaction.commit()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_importexport.txt[26]>", line 1, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 447, in _commitResources
        rm.tpc_finish(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 672, in tpc_finish
        serial = self._storage.tpc_finish(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 182, in tpc_finish
        return self._storage.tpc_finish(transaction, invalidate_finish)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 707, in tpc_finish
        self._finish(tbuf, tid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 722, in _finish
        self._pos, tindex = tbuf.commit(tid, self._file, pos)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 2210, in commit
        rename_or_copy_blob(blobfilename, targetname)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 906, in rename_or_copy_blob
        with open(f1, 'rb') as file1:
    FileNotFoundError: [Errno 2] No such file or directory: '2.bobs/tmp/savepointsepu3adha/0x02-0x00.spb'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_importexport.txt", line 55, in blob_importexport.txt
Failed example:
    bool(items1.keys() == items2.keys())
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_importexport.txt[29]>", line 1, in <module>
        bool(items1.keys() == items2.keys())
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 753, in setstate
        p, serial = self._storage.load(oid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 144, in load
        r = self._storage.loadBefore(oid, self._start)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 476, in loadBefore
        pos = self._lookup_pos(oid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 435, in _lookup_pos
        raise POSKeyError(oid)
    ZODB.POSException.POSKeyError: 0x01
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_importexport.txt", line 57, in blob_importexport.txt
Failed example:
    with items1['blob1'].open() as fp1:
        with items2['blob1'].open() as fp2:
            fp1.read() == fp2.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_importexport.txt[30]>", line 2, in <module>
        with items2['blob1'].open() as fp2:
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 985, in __getitem__
        if key in self.data:
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 753, in setstate
        p, serial = self._storage.load(oid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 144, in load
        r = self._storage.loadBefore(oid, self._start)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 476, in loadBefore
        pos = self._lookup_pos(oid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 435, in _lookup_pos
        raise POSKeyError(oid)
    ZODB.POSException.POSKeyError: 0x01
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_importexport.txt", line 61, in blob_importexport.txt
Failed example:
    with items1['blob2'].open() as fp1:
        with items2['blob2'].open() as fp2:
            fp1.read() == fp2.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_importexport.txt[31]>", line 2, in <module>
        with items2['blob2'].open() as fp2:
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 985, in __getitem__
        if key in self.data:
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 753, in setstate
        p, serial = self._storage.load(oid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 144, in load
        r = self._storage.loadBefore(oid, self._start)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 476, in loadBefore
        pos = self._lookup_pos(oid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 435, in _lookup_pos
        raise POSKeyError(oid)
    ZODB.POSException.POSKeyError: 0x01



Failure in test /home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt
Failed doctest test for blob_transaction.txt
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 0

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 246, in blob_transaction.txt
Failed example:
    transaction.commit()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[90]>", line 1, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 447, in _commitResources
        rm.tpc_finish(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 672, in tpc_finish
        serial = self._storage.tpc_finish(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 182, in tpc_finish
        return self._storage.tpc_finish(transaction, invalidate_finish)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 707, in tpc_finish
        self._finish(tbuf, tid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 722, in _finish
        self._pos, tindex = tbuf.commit(tid, self._file, pos)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 2210, in commit
        rename_or_copy_blob(blobfilename, targetname)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 906, in rename_or_copy_blob
        with open(f1, 'rb') as file1:
    FileNotFoundError: [Errno 2] No such file or directory: 'blobs/tmp/savepointswtrel91h/0x03-0x03d86d06a65c9a33.spb'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 255, in blob_transaction.txt
Failed example:
    with root5['blob'].open("r") as fp:
        fp.read()
Expected:
    "I'm a happy blob. And I'm singing. And I'm dancing."
Got:
    "I'm a happy blob. And I'm dancing."
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 258, in blob_transaction.txt
Failed example:
    savepoint = transaction.savepoint()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[94]>", line 1, in <module>
        savepoint = transaction.savepoint()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 272, in savepoint
        return self.manager.savepoint(optimistic)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 151, in savepoint
        return self.get().savepoint(optimistic)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 221, in savepoint
        self._prior_operation_failed() # doesn't return, it raises
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 178, in _prior_operation_failed
        self._failure_traceback.getvalue())
    transaction.interfaces.TransactionFailedError: An operation previously failed, with traceback:

      File "/home/travis/virtualenv/python3.5.6/bin/zope-testrunner", line 11, in <module>
        sys.exit(run())
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 27, in run
        failed = run_internal(defaults, args, script_parts=script_parts, cwd=cwd)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 44, in run_internal
        runner.run()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 171, in run
        self.run_tests()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 253, in run_tests
        self.skipped, self.import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 425, in run_layer
        import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 345, in run_tests
        test(result)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 653, in __call__
        return self.run(*args, **kwds)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
        testMethod()
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 2185, in runTest
        test, out=new.write, clear_globs=False)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1467, in run
        return self.__run(test, compileflags, out)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[90]>", line 1, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 280, in commit
        t, v, tb = self._saveAndGetCommitishError()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 447, in _commitResources
        rm.tpc_finish(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 672, in tpc_finish
        serial = self._storage.tpc_finish(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 182, in tpc_finish
        return self._storage.tpc_finish(transaction, invalidate_finish)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 707, in tpc_finish
        self._finish(tbuf, tid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 722, in _finish
        self._pos, tindex = tbuf.commit(tid, self._file, pos)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 2210, in commit
        rename_or_copy_blob(blobfilename, targetname)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 906, in rename_or_copy_blob
        with open(f1, 'rb') as file1:
    FileNotFoundError: [Errno 2] No such file or directory: 'blobs/tmp/savepointswtrel91h/0x03-0x03d86d06a65c9a33.spb'

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 262, in blob_transaction.txt
Failed example:
    len([name for name in os.listdir(os.path.join(blob_dir, 'tmp'))
         if name.startswith('savepoint')])
Expected:
    1
Got:
    0
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 268, in blob_transaction.txt
Failed example:
    savepoint.rollback()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[97]>", line 1, in <module>
        savepoint.rollback()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 651, in rollback
        'invalidated by a later savepoint')
    transaction.interfaces.InvalidSavepointRollbackError: invalidated by a later savepoint
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 270, in blob_transaction.txt
Failed example:
    with root5['blob'].open("r") as fp:
        fp.read()
Expected:
    "I'm a happy blob. And I'm singing. And I'm dancing."
Got:
    ' And the weather is beautiful.'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 294, in blob_transaction.txt
Failed example:
    transaction.commit()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[106]>", line 1, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
        rm.commit(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
        self._commit(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
        self._store_objects(ObjectWriter(obj), transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 572, in _store_objects
        s = self._storage.store(oid, serial, p, '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 166, in store
        self._storage.store(oid, serial, data, version, transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 512, in store
        h = self._read_data_header(old, oid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/format.py", line 147, in _read_data_header
        _file.seek(pos)
    ValueError: seek of closed file
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 295, in blob_transaction.txt
Failed example:
    with open(blob.committed()) as fp:
        fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[107]>", line 1, in <module>
        with open(blob.committed()) as fp:
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 221, in committed
        raise BlobError('Uncommitted changes')
    ZODB.interfaces.BlobError: Uncommitted changes
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 301, in blob_transaction.txt
Failed example:
    f = blob.open('c')
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[108]>", line 1, in <module>
        f = blob.open('c')
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 147, in open
        raise BlobError('Uncommitted changes')
    ZODB.interfaces.BlobError: Uncommitted changes
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 305, in blob_transaction.txt
Failed example:
    type(f) == file_type
Expected:
    True
Got:
    False
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 310, in blob_transaction.txt
Failed example:
    with blob.open('w') as file:
        _ = file.write(b'x')
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[110]>", line 1, in <module>
        with blob.open('w') as file:
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 210, in open
        self._p_changed = True
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 792, in register
        self._register(obj)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 802, in _register
        self.transaction_manager.get().join(self)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 184, in join
        self._prior_operation_failed() # doesn't return
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 178, in _prior_operation_failed
        self._failure_traceback.getvalue())
    transaction.interfaces.TransactionFailedError: An operation previously failed, with traceback:

      File "/home/travis/virtualenv/python3.5.6/bin/zope-testrunner", line 11, in <module>
        sys.exit(run())
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 27, in run
        failed = run_internal(defaults, args, script_parts=script_parts, cwd=cwd)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 44, in run_internal
        runner.run()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 171, in run
        self.run_tests()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 253, in run_tests
        self.skipped, self.import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 425, in run_layer
        import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 345, in run_tests
        test(result)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 653, in __call__
        return self.run(*args, **kwds)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
        testMethod()
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 2185, in runTest
        test, out=new.write, clear_globs=False)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1467, in run
        return self.__run(test, compileflags, out)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[106]>", line 1, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 280, in commit
        t, v, tb = self._saveAndGetCommitishError()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
        rm.commit(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 467, in commit
        self._commit(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 516, in _commit
        self._store_objects(ObjectWriter(obj), transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 572, in _store_objects
        s = self._storage.store(oid, serial, p, '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 166, in store
        self._storage.store(oid, serial, data, version, transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 512, in store
        h = self._read_data_header(old, oid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/format.py", line 147, in _read_data_header
        _file.seek(pos)
    ValueError: seek of closed file

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 312, in blob_transaction.txt
Failed example:
    with blob.open() as fp: fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[111]>", line 1, in <module>
        with blob.open() as fp: fp.read()
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 152, in open
        raise BlobError("Already opened for writing.")
    ZODB.interfaces.BlobError: Already opened for writing.
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 315, in blob_transaction.txt
Failed example:
    f.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[112]>", line 1, in <module>
        f.read()
    ValueError: I/O operation on closed file
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 359, in blob_transaction.txt
Failed example:
    transaction.commit()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[125]>", line 1, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
        rm.commit(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 462, in commit
        self._commit_savepoint(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 1011, in _commit_savepoint
        self._storage.store(oid, serial, data, '', transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 166, in store
        self._storage.store(oid, serial, data, version, transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 512, in store
        h = self._read_data_header(old, oid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/format.py", line 147, in _read_data_header
        _file.seek(pos)
    ValueError: seek of closed file
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 360, in blob_transaction.txt
Failed example:
    with open(blob.committed()) as fp:
        fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[126]>", line 1, in <module>
        with open(blob.committed()) as fp:
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 221, in committed
        raise BlobError('Uncommitted changes')
    ZODB.interfaces.BlobError: Uncommitted changes
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 379, in blob_transaction.txt
Failed example:
    olddata, oldserial = blob_storage.load(blob._p_oid, '')
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[128]>", line 1, in <module>
        olddata, oldserial = blob_storage.load(blob._p_oid, '')
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 446, in load
        pos = self._lookup_pos(oid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 433, in _lookup_pos
        return self._index[oid]
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/fsIndex.py", line 108, in __getitem__
        assert isinstance(key, bytes)
    AssertionError
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 384, in blob_transaction.txt
Failed example:
    blob_storage.storeBlob(blob._p_oid, oldserial, olddata, 'blobfile',
                                '', t)
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[132]>", line 1, in <module>
        blob_storage.storeBlob(blob._p_oid, oldserial, olddata, 'blobfile',
    NameError: name 'oldserial' is not defined
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 389, in blob_transaction.txt
Failed example:
    blob_storage.storeBlob(new_oid, '\0'*8, olddata, 'blobfile2',
                                '', t)
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[135]>", line 1, in <module>
        blob_storage.storeBlob(new_oid, '\0'*8, olddata, 'blobfile2',
    NameError: name 'olddata' is not defined
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 397, in blob_transaction.txt
Failed example:
    blob_storage.load(blob._p_oid, '') == (olddata, oldserial)
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[138]>", line 1, in <module>
        blob_storage.load(blob._p_oid, '') == (olddata, oldserial)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 446, in load
        pos = self._lookup_pos(oid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 433, in _lookup_pos
        return self._index[oid]
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/fsIndex.py", line 108, in __getitem__
        assert isinstance(key, bytes)
    AssertionError
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/blob_transaction.txt", line 402, in blob_transaction.txt
Failed example:
    with open(blob_storage.loadBlob(blob._p_oid, oldserial)) as fp:
        fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest blob_transaction.txt[139]>", line 1, in <module>
        with open(blob_storage.loadBlob(blob._p_oid, oldserial)) as fp:
    NameError: name 'oldserial' is not defined



Failure in test commit_from_wrong_partition (ZODB.tests.testblob)
Failed doctest test for ZODB.tests.testblob.commit_from_wrong_partition
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 367, in commit_from_wrong_partition

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 409, in ZODB.tests.testblob.commit_from_wrong_partition
Failed example:
    transaction.commit() # doctest: +ELLIPSIS
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.commit_from_wrong_partition[21]>", line 1, in <module>
        transaction.commit() # doctest: +ELLIPSIS
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 447, in _commitResources
        rm.tpc_finish(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 672, in tpc_finish
        serial = self._storage.tpc_finish(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 182, in tpc_finish
        return self._storage.tpc_finish(transaction, invalidate_finish)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 707, in tpc_finish
        self._finish(tbuf, tid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 722, in _finish
        self._pos, tindex = tbuf.commit(tid, self._file, pos)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 2210, in commit
        rename_or_copy_blob(blobfilename, targetname)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 906, in rename_or_copy_blob
        with open(f1, 'rb') as file1:
    FileNotFoundError: [Errno 2] No such file or directory: 'data.bobs/tmp/savepointsjel3fjv_/0x02-0x00.spb'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 412, in ZODB.tests.testblob.commit_from_wrong_partition
Failed example:
    with root['blob2'].open() as fp: fp.read()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.commit_from_wrong_partition[22]>", line 1, in <module>
        with root['blob2'].open() as fp: fp.read()
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 753, in setstate
        p, serial = self._storage.load(oid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 144, in load
        r = self._storage.loadBefore(oid, self._start)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 476, in loadBefore
        pos = self._lookup_pos(oid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 435, in _lookup_pos
        raise POSKeyError(oid)
    ZODB.POSException.POSKeyError: 0x02



Failure in test savepoint_isolation (ZODB.tests.testblob)
Failed doctest test for ZODB.tests.testblob.savepoint_isolation
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 619, in savepoint_isolation

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 640, in ZODB.tests.testblob.savepoint_isolation
Failed example:
    tm.commit()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest ZODB.tests.testblob.savepoint_isolation[14]>", line 1, in <module>
        tm.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 447, in _commitResources
        rm.tpc_finish(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 672, in tpc_finish
        serial = self._storage.tpc_finish(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 182, in tpc_finish
        return self._storage.tpc_finish(transaction, invalidate_finish)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 707, in tpc_finish
        self._finish(tbuf, tid)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 722, in _finish
        self._pos, tindex = tbuf.commit(tid, self._file, pos)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 2210, in commit
        rename_or_copy_blob(blobfilename, targetname)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/blob.py", line 906, in rename_or_copy_blob
        with open(f1, 'rb') as file1:
    FileNotFoundError: [Errno 2] No such file or directory: 'data.bobs/tmp/savepoints3emkkzud/0x01-0x03d86d06cef2addd.spb'
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testblob.py", line 642, in ZODB.tests.testblob.savepoint_isolation
Failed example:
    with conn.root.b.open() as fp: fp.read()
Expected:
    '2'
Got:
    'initial'

  Ran 22 tests with 19 failures, 1 errors and 0 skipped in 9.854 seconds.
Running .MVCCMappingBlobTests tests:
  Tear down .BlobFileStorageBlobTests in 0.000 seconds.
  Set up .MVCCMappingBlobTests in 0.000 seconds.
  Ran 15 tests with 19 failures, 1 errors and 0 skipped in 2.201 seconds.
Running .repozo tests:
  Tear down .MVCCMappingBlobTests in 0.000 seconds.
  Set up .repozo in 0.000 seconds.


Error in test test_via_monte_carlo (ZODB.scripts.tests.test_repozo.MonteCarloTests)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/scripts/tests/test_repozo.py", line 1106, in test_via_monte_carlo
    self.mutate_pack_backup(i)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/scripts/tests/test_repozo.py", line 1120, in mutate_pack_backup
    self.db.mutate()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/scripts/tests/test_repozo.py", line 89, in mutate
    transaction.commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
    return self.manager.commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
    return self.get().commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
    self._commitResources()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
    rm.commit(self)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 472, in commit
    oid, serial, transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/BaseStorage.py", line 352, in checkCurrentSerialInTransaction
    raise POSException.StorageTransactionError(self, transaction)
ZODB.POSException.StorageTransactionError: (<ZODB.FileStorage.FileStorage.FileStorage object at 0x7fcd95929c18>, <transaction._transaction.Transaction object at 0x7fcd951293c8>)

  Ran 1 tests with 19 failures, 2 errors and 0 skipped in 13.072 seconds.
Running .testFileStorage tests:
  Tear down .repozo in 0.000 seconds.
  Set up .testFileStorage in 0.000 seconds.


Failure in test checkFlushNeededAfterTruncate (ZODB.tests.testFileStorage.FileStorageTests)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testFileStorage.py", line 318, in checkFlushNeededAfterTruncate
    self.checkFlushAfterTruncate(True)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testFileStorage.py", line 305, in checkFlushAfterTruncate
    b'foo' if fail else b'bar')
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 829, in assertEqual
    assertion_func(first, second, msg=msg)
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 822, in _baseAssertEqual
    raise self.failureException(msg)
AssertionError: b'bar' != b'foo'



Error in test checkTwoObjectUndoAtOnce (ZODB.tests.testFileStorage.FileStorageTests)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/TransactionalUndoStorage.py", line 243, in checkTwoObjectUndoAtOnce
    oids = self._begin_undos_vote(t, tid, tid1)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/TransactionalUndoStorage.py", line 78, in _begin_undos_vote
    self._storage.undo(tid, t)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 923, in undo
    self._txn_undo_write(tpos, tbuf)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 962, in _txn_undo_write
    tbuf, h.oid, pos, h.tid, h.prev)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 807, in _transactionalUndoRecord
    ctid, cdataptr, current_data = tbuf.undoDataInfo(oid, tpos)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 2229, in undoDataInfo
    r = self._undoDataInfo(oid, pos)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/format.py", line 239, in _undoDataInfo
    h = self._read_data_header(pos, oid)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/format.py", line 150, in _read_data_header
    raise CorruptedDataError(oid, s, pos)
ZODB.FileStorage.format.CorruptedDataError: Error reading oid 0x01.  Found b'' at 768



Error in test checkUndoLogMetadata (ZODB.tests.testFileStorage.FileStorageTests)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/TransactionalUndoStorage.py", line 655, in checkUndoLogMetadata
    txn.commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
    self._commitResources()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 437, in _commitResources
    rm.tpc_begin(self)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 451, in tpc_begin
    self._normal_storage.tpc_begin(transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 162, in tpc_begin
    self._storage.tpc_begin(transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 664, in tpc_begin
    transaction, tid, status, self._pos, self.fshelper))
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 2093, in __init__
    ext = dumps(ext, _protocol)
NameError: name 'dumps' is not defined



Error in test checkUndoMultipleConflictResolution (ZODB.tests.testFileStorage.FileStorageTests)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/TransactionalUndoStorage.py", line 741, in checkUndoMultipleConflictResolution
    transaction.commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
    return self.manager.commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
    return self.get().commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
    self._commitResources()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
    rm.commit(self)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/DB.py", line 954, in commit
    self._storage.undo(tid, transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 246, in undo
    result = self._storage.undo(transaction_id, transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 923, in undo
    self._txn_undo_write(tpos, tbuf)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 962, in _txn_undo_write
    tbuf, h.oid, pos, h.tid, h.prev)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 807, in _transactionalUndoRecord
    ctid, cdataptr, current_data = tbuf.undoDataInfo(oid, tpos)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 2229, in undoDataInfo
    r = self._undoDataInfo(oid, pos)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/format.py", line 239, in _undoDataInfo
    h = self._read_data_header(pos, oid)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/format.py", line 150, in _read_data_header
    raise CorruptedDataError(oid, s, pos)
ZODB.FileStorage.format.CorruptedDataError: Error reading oid 0x01.  Found b'' at 1050



Error in test checkUndoMultipleConflictResolutionReversed (ZODB.tests.testFileStorage.FileStorageTests)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/TransactionalUndoStorage.py", line 747, in checkUndoMultipleConflictResolutionReversed
    self.checkUndoMultipleConflictResolution(True)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/TransactionalUndoStorage.py", line 741, in checkUndoMultipleConflictResolution
    transaction.commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
    return self.manager.commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
    return self.get().commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
    self._commitResources()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
    rm.commit(self)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/DB.py", line 954, in commit
    self._storage.undo(tid, transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 246, in undo
    result = self._storage.undo(transaction_id, transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 923, in undo
    self._txn_undo_write(tpos, tbuf)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 962, in _txn_undo_write
    tbuf, h.oid, pos, h.tid, h.prev)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 807, in _transactionalUndoRecord
    ctid, cdataptr, current_data = tbuf.undoDataInfo(oid, tpos)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 2229, in undoDataInfo
    r = self._undoDataInfo(oid, pos)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/format.py", line 239, in _undoDataInfo
    h = self._read_data_header(pos, oid)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/format.py", line 150, in _read_data_header
    raise CorruptedDataError(oid, s, pos)
ZODB.FileStorage.format.CorruptedDataError: Error reading oid 0x01.  Found b'' at 1050



Error in test check_checkCurrentSerialInTransaction (ZODB.tests.testFileStorage.FileStorageTests)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/BasicStorage.py", line 233, in check_checkCurrentSerialInTransaction
    self._storage.checkCurrentSerialInTransaction(oid, tid, t)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/BaseStorage.py", line 352, in checkCurrentSerialInTransaction
    raise POSException.StorageTransactionError(self, transaction)
ZODB.POSException.StorageTransactionError: (<ZODB.FileStorage.FileStorage.FileStorage object at 0x7fcd951293c8>, <transaction._transaction.Transaction object at 0x7fcd95145358>)



Error in test check_tid_ordering_w_commit (ZODB.tests.testFileStorage.FileStorageTests)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/BasicStorage.py", line 326, in check_tid_ordering_w_commit
    self._storage.tpc_begin(t)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 659, in tpc_begin
    "Duplicate tpc_begin calls for same transaction")
ZODB.POSException.StorageTransactionError: Duplicate tpc_begin calls for same transaction



Failure in test checkFlushNeededAfterTruncate (ZODB.tests.testFileStorage.FileStorageHexTests)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testFileStorage.py", line 318, in checkFlushNeededAfterTruncate
    self.checkFlushAfterTruncate(True)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testFileStorage.py", line 305, in checkFlushAfterTruncate
    b'foo' if fail else b'bar')
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 829, in assertEqual
    assertion_func(first, second, msg=msg)
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 822, in _baseAssertEqual
    raise self.failureException(msg)
AssertionError: b'bar' != b'foo'



Error in test checkTwoObjectUndoAtOnce (ZODB.tests.testFileStorage.FileStorageHexTests)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/TransactionalUndoStorage.py", line 243, in checkTwoObjectUndoAtOnce
    oids = self._begin_undos_vote(t, tid, tid1)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/TransactionalUndoStorage.py", line 78, in _begin_undos_vote
    self._storage.undo(tid, t)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 923, in undo
    self._txn_undo_write(tpos, tbuf)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 962, in _txn_undo_write
    tbuf, h.oid, pos, h.tid, h.prev)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 807, in _transactionalUndoRecord
    ctid, cdataptr, current_data = tbuf.undoDataInfo(oid, tpos)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 2229, in undoDataInfo
    r = self._undoDataInfo(oid, pos)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/format.py", line 239, in _undoDataInfo
    h = self._read_data_header(pos, oid)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/format.py", line 150, in _read_data_header
    raise CorruptedDataError(oid, s, pos)
ZODB.FileStorage.format.CorruptedDataError: Error reading oid 0x01.  Found b'' at 1176



Error in test checkUndoLogMetadata (ZODB.tests.testFileStorage.FileStorageHexTests)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/TransactionalUndoStorage.py", line 655, in checkUndoLogMetadata
    txn.commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
    self._commitResources()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 437, in _commitResources
    rm.tpc_begin(self)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 451, in tpc_begin
    self._normal_storage.tpc_begin(transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 162, in tpc_begin
    self._storage.tpc_begin(transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 664, in tpc_begin
    transaction, tid, status, self._pos, self.fshelper))
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 2093, in __init__
    ext = dumps(ext, _protocol)
NameError: name 'dumps' is not defined



Error in test checkUndoMultipleConflictResolution (ZODB.tests.testFileStorage.FileStorageHexTests)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/TransactionalUndoStorage.py", line 741, in checkUndoMultipleConflictResolution
    transaction.commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
    return self.manager.commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
    return self.get().commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
    self._commitResources()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
    rm.commit(self)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/DB.py", line 954, in commit
    self._storage.undo(tid, transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 246, in undo
    result = self._storage.undo(transaction_id, transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 923, in undo
    self._txn_undo_write(tpos, tbuf)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 962, in _txn_undo_write
    tbuf, h.oid, pos, h.tid, h.prev)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 807, in _transactionalUndoRecord
    ctid, cdataptr, current_data = tbuf.undoDataInfo(oid, tpos)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 2229, in undoDataInfo
    r = self._undoDataInfo(oid, pos)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/format.py", line 239, in _undoDataInfo
    h = self._read_data_header(pos, oid)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/format.py", line 150, in _read_data_header
    raise CorruptedDataError(oid, s, pos)
ZODB.FileStorage.format.CorruptedDataError: Error reading oid 0x01.  Found b'' at 1578



Error in test checkUndoMultipleConflictResolutionReversed (ZODB.tests.testFileStorage.FileStorageHexTests)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/TransactionalUndoStorage.py", line 747, in checkUndoMultipleConflictResolutionReversed
    self.checkUndoMultipleConflictResolution(True)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/TransactionalUndoStorage.py", line 741, in checkUndoMultipleConflictResolution
    transaction.commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
    return self.manager.commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
    return self.get().commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
    self._commitResources()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
    rm.commit(self)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/DB.py", line 954, in commit
    self._storage.undo(tid, transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 246, in undo
    result = self._storage.undo(transaction_id, transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 923, in undo
    self._txn_undo_write(tpos, tbuf)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 962, in _txn_undo_write
    tbuf, h.oid, pos, h.tid, h.prev)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 807, in _transactionalUndoRecord
    ctid, cdataptr, current_data = tbuf.undoDataInfo(oid, tpos)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 2229, in undoDataInfo
    r = self._undoDataInfo(oid, pos)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/format.py", line 239, in _undoDataInfo
    h = self._read_data_header(pos, oid)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/format.py", line 150, in _read_data_header
    raise CorruptedDataError(oid, s, pos)
ZODB.FileStorage.format.CorruptedDataError: Error reading oid 0x01.  Found b'' at 1578



Error in test check_checkCurrentSerialInTransaction (ZODB.tests.testFileStorage.FileStorageHexTests)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/BasicStorage.py", line 233, in check_checkCurrentSerialInTransaction
    self._storage.checkCurrentSerialInTransaction(oid, tid, t)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/BaseStorage.py", line 352, in checkCurrentSerialInTransaction
    raise POSException.StorageTransactionError(self, transaction)
ZODB.POSException.StorageTransactionError: (<ZODB.FileStorage.FileStorage.FileStorage object at 0x7fcd950fac50>, <transaction._transaction.Transaction object at 0x7fcd951454a8>)



Error in test check_tid_ordering_w_commit (ZODB.tests.testFileStorage.FileStorageHexTests)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/BasicStorage.py", line 326, in check_tid_ordering_w_commit
    self._storage.tpc_begin(t)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 659, in tpc_begin
    "Duplicate tpc_begin calls for same transaction")
ZODB.POSException.StorageTransactionError: Duplicate tpc_begin calls for same transaction



Error in test checkRestoreAcrossPack (ZODB.tests.testFileStorage.FileStorageRecoveryTest)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/RecoveryStorage.py", line 65, in checkRestoreAcrossPack
    final)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 629, in restore
    tbuf.store(oid, data, old, False)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 2118, in store
    h = DataHeader(oid, z64, prev, self.tpos, 0, len(data)).asString()
TypeError: object of type 'NoneType' has no len()



Error in test checkRestoreAcrossPack (ZODB.tests.testFileStorage.FileStorageHexRecoveryTest)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/RecoveryStorage.py", line 65, in checkRestoreAcrossPack
    final)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/hexstorage.py", line 81, in restore
    transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 629, in restore
    tbuf.store(oid, data, old, False)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 2118, in store
    h = DataHeader(oid, z64, prev, self.tpos, 0, len(data)).asString()
TypeError: object of type 'NoneType' has no len()



Failure in test checkFlushNeededAfterTruncate (ZODB.tests.testFileStorage.FileStorageTestsWithBlobsEnabled)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testFileStorage.py", line 318, in checkFlushNeededAfterTruncate
    self.checkFlushAfterTruncate(True)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testFileStorage.py", line 305, in checkFlushAfterTruncate
    b'foo' if fail else b'bar')
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 829, in assertEqual
    assertion_func(first, second, msg=msg)
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 822, in _baseAssertEqual
    raise self.failureException(msg)
AssertionError: b'bar' != b'foo'



Error in test checkTwoObjectUndoAtOnce (ZODB.tests.testFileStorage.FileStorageTestsWithBlobsEnabled)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/TransactionalUndoStorage.py", line 243, in checkTwoObjectUndoAtOnce
    oids = self._begin_undos_vote(t, tid, tid1)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/TransactionalUndoStorage.py", line 78, in _begin_undos_vote
    self._storage.undo(tid, t)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 923, in undo
    self._txn_undo_write(tpos, tbuf)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 962, in _txn_undo_write
    tbuf, h.oid, pos, h.tid, h.prev)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 807, in _transactionalUndoRecord
    ctid, cdataptr, current_data = tbuf.undoDataInfo(oid, tpos)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 2229, in undoDataInfo
    r = self._undoDataInfo(oid, pos)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/format.py", line 239, in _undoDataInfo
    h = self._read_data_header(pos, oid)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/format.py", line 150, in _read_data_header
    raise CorruptedDataError(oid, s, pos)
ZODB.FileStorage.format.CorruptedDataError: Error reading oid 0x01.  Found b'' at 768



Error in test checkUndoLogMetadata (ZODB.tests.testFileStorage.FileStorageTestsWithBlobsEnabled)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/TransactionalUndoStorage.py", line 655, in checkUndoLogMetadata
    txn.commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
    self._commitResources()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 437, in _commitResources
    rm.tpc_begin(self)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 451, in tpc_begin
    self._normal_storage.tpc_begin(transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 162, in tpc_begin
    self._storage.tpc_begin(transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 664, in tpc_begin
    transaction, tid, status, self._pos, self.fshelper))
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 2093, in __init__
    ext = dumps(ext, _protocol)
NameError: name 'dumps' is not defined



Error in test checkUndoMultipleConflictResolution (ZODB.tests.testFileStorage.FileStorageTestsWithBlobsEnabled)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/TransactionalUndoStorage.py", line 741, in checkUndoMultipleConflictResolution
    transaction.commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
    return self.manager.commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
    return self.get().commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
    self._commitResources()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
    rm.commit(self)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/DB.py", line 954, in commit
    self._storage.undo(tid, transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 246, in undo
    result = self._storage.undo(transaction_id, transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 923, in undo
    self._txn_undo_write(tpos, tbuf)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 962, in _txn_undo_write
    tbuf, h.oid, pos, h.tid, h.prev)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 807, in _transactionalUndoRecord
    ctid, cdataptr, current_data = tbuf.undoDataInfo(oid, tpos)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 2229, in undoDataInfo
    r = self._undoDataInfo(oid, pos)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/format.py", line 239, in _undoDataInfo
    h = self._read_data_header(pos, oid)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/format.py", line 150, in _read_data_header
    raise CorruptedDataError(oid, s, pos)
ZODB.FileStorage.format.CorruptedDataError: Error reading oid 0x01.  Found b'' at 1050



Error in test checkUndoMultipleConflictResolutionReversed (ZODB.tests.testFileStorage.FileStorageTestsWithBlobsEnabled)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/TransactionalUndoStorage.py", line 747, in checkUndoMultipleConflictResolutionReversed
    self.checkUndoMultipleConflictResolution(True)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/TransactionalUndoStorage.py", line 741, in checkUndoMultipleConflictResolution
    transaction.commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
    return self.manager.commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
    return self.get().commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
    self._commitResources()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
    rm.commit(self)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/DB.py", line 954, in commit
    self._storage.undo(tid, transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 246, in undo
    result = self._storage.undo(transaction_id, transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 923, in undo
    self._txn_undo_write(tpos, tbuf)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 962, in _txn_undo_write
    tbuf, h.oid, pos, h.tid, h.prev)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 807, in _transactionalUndoRecord
    ctid, cdataptr, current_data = tbuf.undoDataInfo(oid, tpos)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 2229, in undoDataInfo
    r = self._undoDataInfo(oid, pos)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/format.py", line 239, in _undoDataInfo
    h = self._read_data_header(pos, oid)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/format.py", line 150, in _read_data_header
    raise CorruptedDataError(oid, s, pos)
ZODB.FileStorage.format.CorruptedDataError: Error reading oid 0x01.  Found b'' at 1050



Error in test check_checkCurrentSerialInTransaction (ZODB.tests.testFileStorage.FileStorageTestsWithBlobsEnabled)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/BasicStorage.py", line 233, in check_checkCurrentSerialInTransaction
    self._storage.checkCurrentSerialInTransaction(oid, tid, t)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/BaseStorage.py", line 352, in checkCurrentSerialInTransaction
    raise POSException.StorageTransactionError(self, transaction)
ZODB.POSException.StorageTransactionError: (<ZODB.FileStorage.FileStorage.FileStorage object at 0x7fcd950a21d0>, <transaction._transaction.Transaction object at 0x7fcd9509d588>)



Error in test check_tid_ordering_w_commit (ZODB.tests.testFileStorage.FileStorageTestsWithBlobsEnabled)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/BasicStorage.py", line 326, in check_tid_ordering_w_commit
    self._storage.tpc_begin(t)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 659, in tpc_begin
    "Duplicate tpc_begin calls for same transaction")
ZODB.POSException.StorageTransactionError: Duplicate tpc_begin calls for same transaction



Failure in test checkFlushNeededAfterTruncate (ZODB.tests.testFileStorage.FileStorageHexTestsWithBlobsEnabled)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testFileStorage.py", line 318, in checkFlushNeededAfterTruncate
    self.checkFlushAfterTruncate(True)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testFileStorage.py", line 305, in checkFlushAfterTruncate
    b'foo' if fail else b'bar')
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 829, in assertEqual
    assertion_func(first, second, msg=msg)
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 822, in _baseAssertEqual
    raise self.failureException(msg)
AssertionError: b'bar' != b'foo'



Error in test checkTwoObjectUndoAtOnce (ZODB.tests.testFileStorage.FileStorageHexTestsWithBlobsEnabled)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/TransactionalUndoStorage.py", line 243, in checkTwoObjectUndoAtOnce
    oids = self._begin_undos_vote(t, tid, tid1)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/TransactionalUndoStorage.py", line 78, in _begin_undos_vote
    self._storage.undo(tid, t)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 923, in undo
    self._txn_undo_write(tpos, tbuf)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 962, in _txn_undo_write
    tbuf, h.oid, pos, h.tid, h.prev)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 807, in _transactionalUndoRecord
    ctid, cdataptr, current_data = tbuf.undoDataInfo(oid, tpos)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 2229, in undoDataInfo
    r = self._undoDataInfo(oid, pos)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/format.py", line 239, in _undoDataInfo
    h = self._read_data_header(pos, oid)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/format.py", line 150, in _read_data_header
    raise CorruptedDataError(oid, s, pos)
ZODB.FileStorage.format.CorruptedDataError: Error reading oid 0x01.  Found b'' at 1176



Error in test checkUndoLogMetadata (ZODB.tests.testFileStorage.FileStorageHexTestsWithBlobsEnabled)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/TransactionalUndoStorage.py", line 655, in checkUndoLogMetadata
    txn.commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
    self._commitResources()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 437, in _commitResources
    rm.tpc_begin(self)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 451, in tpc_begin
    self._normal_storage.tpc_begin(transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 162, in tpc_begin
    self._storage.tpc_begin(transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 664, in tpc_begin
    transaction, tid, status, self._pos, self.fshelper))
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 2093, in __init__
    ext = dumps(ext, _protocol)
NameError: name 'dumps' is not defined



Error in test checkUndoMultipleConflictResolution (ZODB.tests.testFileStorage.FileStorageHexTestsWithBlobsEnabled)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/TransactionalUndoStorage.py", line 741, in checkUndoMultipleConflictResolution
    transaction.commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
    return self.manager.commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
    return self.get().commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
    self._commitResources()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
    rm.commit(self)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/DB.py", line 954, in commit
    self._storage.undo(tid, transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 246, in undo
    result = self._storage.undo(transaction_id, transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 923, in undo
    self._txn_undo_write(tpos, tbuf)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 962, in _txn_undo_write
    tbuf, h.oid, pos, h.tid, h.prev)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 807, in _transactionalUndoRecord
    ctid, cdataptr, current_data = tbuf.undoDataInfo(oid, tpos)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 2229, in undoDataInfo
    r = self._undoDataInfo(oid, pos)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/format.py", line 239, in _undoDataInfo
    h = self._read_data_header(pos, oid)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/format.py", line 150, in _read_data_header
    raise CorruptedDataError(oid, s, pos)
ZODB.FileStorage.format.CorruptedDataError: Error reading oid 0x01.  Found b'' at 1578



Error in test checkUndoMultipleConflictResolutionReversed (ZODB.tests.testFileStorage.FileStorageHexTestsWithBlobsEnabled)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/TransactionalUndoStorage.py", line 747, in checkUndoMultipleConflictResolutionReversed
    self.checkUndoMultipleConflictResolution(True)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/TransactionalUndoStorage.py", line 741, in checkUndoMultipleConflictResolution
    transaction.commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
    return self.manager.commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
    return self.get().commit()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
    self._commitResources()
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
    reraise(t, v, tb)
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
    raise value
  File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 439, in _commitResources
    rm.commit(self)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/DB.py", line 954, in commit
    self._storage.undo(tid, transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 246, in undo
    result = self._storage.undo(transaction_id, transaction)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 923, in undo
    self._txn_undo_write(tpos, tbuf)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 962, in _txn_undo_write
    tbuf, h.oid, pos, h.tid, h.prev)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 807, in _transactionalUndoRecord
    ctid, cdataptr, current_data = tbuf.undoDataInfo(oid, tpos)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 2229, in undoDataInfo
    r = self._undoDataInfo(oid, pos)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/format.py", line 239, in _undoDataInfo
    h = self._read_data_header(pos, oid)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/format.py", line 150, in _read_data_header
    raise CorruptedDataError(oid, s, pos)
ZODB.FileStorage.format.CorruptedDataError: Error reading oid 0x01.  Found b'' at 1578



Error in test check_checkCurrentSerialInTransaction (ZODB.tests.testFileStorage.FileStorageHexTestsWithBlobsEnabled)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/BasicStorage.py", line 233, in check_checkCurrentSerialInTransaction
    self._storage.checkCurrentSerialInTransaction(oid, tid, t)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/BaseStorage.py", line 352, in checkCurrentSerialInTransaction
    raise POSException.StorageTransactionError(self, transaction)
ZODB.POSException.StorageTransactionError: (<ZODB.FileStorage.FileStorage.FileStorage object at 0x7fcd95125b00>, <transaction._transaction.Transaction object at 0x7fcd95129668>)



Error in test check_tid_ordering_w_commit (ZODB.tests.testFileStorage.FileStorageHexTestsWithBlobsEnabled)
Traceback (most recent call last):
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 59, in testPartExecutor
    yield
  File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
    testMethod()
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/BasicStorage.py", line 326, in check_tid_ordering_w_commit
    self._storage.tpc_begin(t)
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 659, in tpc_begin
    "Duplicate tpc_begin calls for same transaction")
ZODB.POSException.StorageTransactionError: Duplicate tpc_begin calls for same transaction



Failure in test deal_with_finish_failures (ZODB.tests.testFileStorage)
Failed doctest test for ZODB.tests.testFileStorage.deal_with_finish_failures
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testFileStorage.py", line 601, in deal_with_finish_failures

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/testFileStorage.py", line 639, in ZODB.tests.testFileStorage.deal_with_finish_failures
Failed example:
    load_current(fs, b'\0'*8) # doctest: +ELLIPSIS
Expected:
    Traceback (most recent call last):
    ...
    ValueError: ...
Got:
    ('\x80\x03cpersistent.mapping\nPersistentMapping\nq\x00.\x80\x03}q\x01X\x04\x00\x00\x00dataq\x02}q\x03K\x01K\x01ss.', '\x03\xd8m\x07\xe4{$\x00')



Failure in test /home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/IExternalGC.test
Failed doctest test for IExternalGC.test
  File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/IExternalGC.test", line 0

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/IExternalGC.test", line 113, in IExternalGC.test
Failed example:
    transaction.commit()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest IExternalGC.test[41]>", line 1, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 282, in commit
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 437, in _commitResources
        rm.tpc_begin(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 451, in tpc_begin
        self._normal_storage.tpc_begin(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 162, in tpc_begin
        self._storage.tpc_begin(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 659, in tpc_begin
        "Duplicate tpc_begin calls for same transaction")
    ZODB.POSException.StorageTransactionError: Duplicate tpc_begin calls for same transaction
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/IExternalGC.test", line 114, in IExternalGC.test
Failed example:
    oid = conn.root()[0]._p_oid
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest IExternalGC.test[42]>", line 1, in <module>
        oid = conn.root()[0]._p_oid
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 989, in __getitem__
        raise KeyError(key)
    KeyError: 0
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/IExternalGC.test", line 115, in IExternalGC.test
Failed example:
    bad_serial = conn.root()[0]._p_serial
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest IExternalGC.test[43]>", line 1, in <module>
        bad_serial = conn.root()[0]._p_serial
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 989, in __getitem__
        raise KeyError(key)
    KeyError: 0
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/IExternalGC.test", line 116, in IExternalGC.test
Failed example:
    conn.root()[0].x = 1
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest IExternalGC.test[44]>", line 1, in <module>
        conn.root()[0].x = 1
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/collections/__init__.py", line 989, in __getitem__
        raise KeyError(key)
    KeyError: 0
----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/IExternalGC.test", line 117, in IExternalGC.test
Failed example:
    transaction.commit()
Exception raised:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest IExternalGC.test[45]>", line 1, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 265, in commit
        self._prior_operation_failed() # doesn't return
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 178, in _prior_operation_failed
        self._failure_traceback.getvalue())
    transaction.interfaces.TransactionFailedError: An operation previously failed, with traceback:

      File "/home/travis/virtualenv/python3.5.6/bin/zope-testrunner", line 11, in <module>
        sys.exit(run())
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 27, in run
        failed = run_internal(defaults, args, script_parts=script_parts, cwd=cwd)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/__init__.py", line 44, in run_internal
        runner.run()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 171, in run
        self.run_tests()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 253, in run_tests
        self.skipped, self.import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 425, in run_layer
        import_errors)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/zope/testrunner/runner.py", line 345, in run_tests
        test(result)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 653, in __call__
        return self.run(*args, **kwds)
      File "/opt/python/3.5.6/lib/python3.5/unittest/case.py", line 605, in run
        testMethod()
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 2185, in runTest
        test, out=new.write, clear_globs=False)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1467, in run
        return self.__run(test, compileflags, out)
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest IExternalGC.test[41]>", line 1, in <module>
        transaction.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 257, in commit
        return self.manager.commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_manager.py", line 135, in commit
        return self.get().commit()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 280, in commit
        t, v, tb = self._saveAndGetCommitishError()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 273, in commit
        self._commitResources()
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 465, in _commitResources
        reraise(t, v, tb)
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_compat.py", line 45, in reraise
        raise value
      File "/home/travis/virtualenv/python3.5.6/lib/python3.5/site-packages/transaction/_transaction.py", line 437, in _commitResources
        rm.tpc_begin(self)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/Connection.py", line 451, in tpc_begin
        self._normal_storage.tpc_begin(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/mvccadapter.py", line 162, in tpc_begin
        self._storage.tpc_begin(transaction)
      File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/FileStorage/FileStorage.py", line 659, in tpc_begin
        "Duplicate tpc_begin calls for same transaction")
    ZODB.POSException.StorageTransactionError: Duplicate tpc_begin calls for same transaction

----------------------------------------------------------------------
File "/home/travis/build/failed/zopefoundation/ZODB/src/ZODB/tests/IExternalGC.test", line 121, in IExternalGC.test
Failed example:
    storage.deleteObject(oid, bad_serial, txn); storage.tpc_vote(txn)
    # doctest: +ELLIPSIS
Expected:
    Traceback (most recent call last):
    ...
    ConflictError: database conflict error ...
Got:
    Traceback (most recent call last):
      File "/opt/python/3.5.6/lib/python3.5/doctest.py", line 1321, in __run
        compileflags, 1), test.globs)
      File "<doctest IExternalGC.test[48]>", line 1, in <module>
        storage.deleteObject(oid, bad_serial, txn); storage.tpc_vote(txn)
    NameError: name 'oid' is not defined

  Ran 416 tests with 25 failures, 27 errors and 0 skipped in 49.834 seconds.
Tearing down left over layers:
  Tear down .testFileStorage in 0.000 seconds.

Test-modules with import problems:
  ZODB.tests.test_datamanageradapter
Total: 498 tests, 25 failures, 34 errors and 0 skipped in 1 minutes 30.642 seconds.

travis_time:end:252631c0:start=1591601662781738954,finish=1591601754076489035,duration=91294750081[0K
[31;1mThe command "zope-testrunner -f --test-path=src --auto-color --auto-progress" exited with 1.[0m
travis_fold:start:before_cache[0Ktravis_time:start:1273f75a[0K$ rm -f $HOME/.cache/pip/log/debug.log

travis_time:end:1273f75a:start=1591601754085209932,finish=1591601754095070085,duration=9860153[0Ktravis_fold:end:before_cache[0Ktravis_fold:start:cache.2[0Kstore build cache
travis_time:start:05d8a880[0K
travis_time:end:05d8a880:start=1591601754106846789,finish=1591601754116546437,duration=9699648[0Ktravis_time:start:0d6f0ca5[0K[32;1mchanges detected, packing new archive[0m

travis_time:end:0d6f0ca5:start=1591601754127734028,finish=1591601755904254479,duration=1776520451[0Ktravis_fold:end:cache.2[0K
Done. Your build exited with 1.
